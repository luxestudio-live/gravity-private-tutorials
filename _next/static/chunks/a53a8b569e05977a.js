(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51565,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(k(e,ArrayBuffer)||e&&k(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(k(e,SharedArrayBuffer)||e&&k(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||k(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=D[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),k(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(k(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",p=0;p<f;)g+=String.fromCharCode.apply(String,d.slice(p,p+=4096));return g}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function _(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function E(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,A(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,A(x(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return A(x(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function C(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function k(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var D=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,g=n?1:-1,p=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=g,a/=256,u-=8);e[r+f-g]|=128*p}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/node_modules/.pnpm/next@16.0.10_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},76009,19678,46805,e=>{"use strict";var t,r,n,i,s,a,o,l,u,h,c,d,f,g,p,m,y,w,v=e.i(54093);(0,v.registerVersion)("firebase","12.9.0","app");var b=v,_=e.i(71075),b=v;e.i(62114);var I=e.i(63415),E=e.i(37305),T=e.i(68519),S=e.i(51565),x=_,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,A={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function s(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,n=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new a(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new v(c,c);if(p(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(p(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=_(r),n=_(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!g(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);p(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function _(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new a(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,i=[];for(let s=0;s<n;s++)i[s]=t>0?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new a(i,e.h)}(o=a.prototype).m=function(){if(p(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(p(this))return"-"+m(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(g(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return p(e=y(this,e))?-1:+!g(e)},o.abs=function(){return p(this)?m(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new a(r,-0x80000000&r[r.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return c;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new a(r,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new a(r,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new a(r,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new a(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,i=A.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},n=A.Integer=a}).apply(void 0!==C?C:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var k=e.i(63337),D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,N={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof D&&D];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var f=f||{},g=this||self;function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function m(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=m).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function _(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var E=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,x=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let r=E.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},A=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(k)}};function k(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}E.j(t),E.h<100&&(E.h++,t.next=E.g,E.g=t)}x=!1}function R(){this.u=this.u,this.C=this.C}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function L(e){return/^[\s\xa0]*$/.test(e)}function P(e,t){O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(P,O),P.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&P.Z.h.call(this)},P.prototype.h=function(){P.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function j(e){let t={};for(let r in e)t[r]=e[r];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<z.length;t++)r=z[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function K(e){this.src=e,this.g={},this.h=0}function G(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(B(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function Q(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}K.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=Q(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new U(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function J(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=p(i)?!!i.capture:!!i,o=ee(e);if(o||(e[H]=o=new K(e)),(r=o.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Z.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)M||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])G(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(X(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=ee(t))?(G(r,e),0==r.h&&(r.src=null,t[H]=null)):B(e)}}}function X(e){return e in W?W[e]:W[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new P(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Y(e),e=r.call(n,t)}return e}function ee(e){return(e=e[H])instanceof K?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function er(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function en(){R.call(this),this.i=new K(this),this.M=this,this.G=null}function ei(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new O(t,e);else if(t instanceof O)t.target=t.target||e;else{var a=t;$(t=new O(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=es(r=t.g=i[n],s,!0,t)&&a;if(a=es(r=t.g=e,s,!0,t)&&a,a=es(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=es(r=t.g=i[n],s,!1,t)&&a}function es(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&G(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(en,R),en.prototype[F]=!0,en.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=p(i)?!!i.capture:!!i,n=er(n),t&&t[F])?(t=t.i,(a=String(r).toString())in t.g&&(n=Q(r=t.g[a],n,i,s))>-1&&(B(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=ee(t))&&(r=t.g[r.toString()],t=-1,r&&(t=Q(r,n,i,s)),(n=t>-1?r[t]:null)&&Y(n))}(this,e,t,r,n)},en.prototype.N=function(){if(en.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)B(r[e]);delete e.g[t],e.h--}}this.G=null},en.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},en.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ea extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:g.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eo(e){R.call(this),this.h=e,this.g={}}v(eo,R);var el=[];function eu(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}eo.prototype.N=function(){eo.Z.N.call(this),eu(this)},eo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eh=g.JSON.stringify,ec=g.JSON.parse,ed=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function ef(){}function eg(){}var ep={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function em(){O.call(this,"d")}function ey(){O.call(this,"c")}v(em,O),v(ey,O);var ew={},ev=null;function eb(){return ev=ev||new en}function e_(e){O.call(this,ew.Ia,e)}function eI(e){let t=eb();ei(t,new e_(t))}function eE(e,t){O.call(this,ew.STAT_EVENT,e),this.stat=t}function eT(e){let t=eb();ei(t,new eE(t,e))}function eS(e,t){O.call(this,ew.Ja,e),this.size=t}function ex(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eC(){this.g=!0}function eA(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return eh(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}ew.Ia="serverreachability",v(e_,O),ew.STAT_EVENT="statevent",v(eE,O),ew.Ja="timingevent",v(eS,O),eC.prototype.ua=function(){this.g=!1},eC.prototype.info=function(){};var ek={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eD={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eR(e){return encodeURIComponent(String(e))}function eO(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new eo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eM}function eM(){this.i=null,this.g="",this.h=!1}v(eN,ef),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eL={},eP={};function eF(e,t,r){e.M=1,e.A=e4(e2(t)),e.u=r,e.R=!0,eV(e,null)}function eV(e,t){e.F=Date.now(),eB(e),e.B=e2(e.A);var r,n,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tc(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eM,e.g=tY(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ea(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var h="readystatechange";Array.isArray(h)||(h&&(el[0]=h.toString()),h=el);for(let e=0;e<h.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.K(r,n,p(i)?!!i.capture:!!i,s):J(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.J(r,n,p(i)?!!i.capture:!!i,s):J(t,r,n,!1,i,s)}(l,h[e],u||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eI(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,o=e.u,r.info(function(){if(r.g)if(o){var e="",t=o.split("&");for(let r=0;r<t.length;r++){var l=t[r].split("=");if(l.length>1){let t=l[0];l=l[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eB(e){e.T=Date.now()+e.H,eq(e,e.H)}function eq(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ex(y(e.aa,e),t)}function ej(e){e.D&&(g.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||tG(e.j,e)}function e$(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eK(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eJ(r.h,e))){if(!e.L&&eJ(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tK(r),tL(r);else break e;tj(r),eT(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=ex(y(r.Va,r),6e3));1>=eW(r.h)&&r.ta&&(r.ta=void 0)}else tH(r,11)}else if((e.L||r.g==e)&&tK(r),!L(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eY(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e8(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eX(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(ej(e),eB(e)),n.g=e}else tq(n);r.i.length>0&&tF(r)}else"stop"!=o[0]&&"close"!=o[0]||tH(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tH(r,7):tM(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eI(4)}catch(e){}}eO.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tD(e)?t.j():this.Y(e)},eO.prototype.Y=function(e){try{if(e==this.g)e:{let d=tD(this.g),f=this.g.ya(),p=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tN(this.g)))){this.K||4!=d||7==f||(8==f||p<=0?eI(3):eI(2)),ej(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eU(e))return e.g.la();let t=tN(e.g);if(""===t)return"";let r="",n=t.length,i=4==tD(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return e$(e),ez(e),"";e.h.i=new g.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,a=this.l,o=this.S,n.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(l)){var h=l;break t}}h=null}if(e=h)eA(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eK(this,e);else{this.o=!1,this.m=3,eT(12),e$(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eP:isNaN(r=Number(t.substring(r,n)))?eL:(n+=1)+r>t.length?eP:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eP){4==d&&(this.m=4,eT(14),e=!1),eA(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eL){this.m=4,eT(15),eA(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eA(this.i,this.l,t,null),eK(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=r.length||this.h.h||(this.m=1,eT(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(c),c.P=!0,eT(11))}}else eA(this.i,this.l,r,"[Invalid Chunked Response]"),e$(this),ez(this)}else eA(this.i,this.l,r,null),eK(this,r);4==d&&e$(this),this.o&&!this.K&&(4==d?tG(this.j,this):(this.o=!1,eB(this)))}else(function(e){let t={};e=(e.g&&tD(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(L(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eT(12)):(this.m=0,eT(13)),e$(this),ez(this)}}}catch(e){}finally{}},eO.prototype.cancel=function(){this.K=!0,e$(this)},eO.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eI(),eT(17)),e$(this),this.m=2,ez(this)):eq(this,this.T-r)};var eG=class{constructor(e,t){this.g=e,this.map=t}};function eQ(e){this.l=e||10,e=g.PerformanceNavigationTiming?(e=g.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eH(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eW(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eY(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return _(e.i)}eQ.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e5(this,e.j),this.o=e.o,this.g=e.g,e6(this,e.u),this.h=e.h,e3(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e5(this,t[1]||"",!0),this.o=e9(t[2]||""),this.g=e9(t[3]||"",!0),e6(this,t[4]),this.h=e9(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e9(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e2(e){return new e1(e)}function e5(e,t,r){e.j=r?e9(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e6(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,r){var n,i;t instanceof ta?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(to(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(tl(this,t),tc(this,r,e))},n)),n.j=i):(r||(t=e7(t,ti)),e.i=new ta(t,e.l))}function e8(e,t,r){e.i.set(t,r)}function e4(e){return e8(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e9(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e7(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,te),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e7(t,tt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e7(t,tt,!0),"@"),e.push(eR(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e7(r,"/"==r.charAt(0)?tn:tr,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e7(r,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),r=!!e.j;r?e5(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e6(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e3(t,td(e.i)):r=!!e.m,r&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tr=/[#\?:]/g,tn=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let r=[];if("string"==typeof t)tu(e,t)&&(r=r.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tc(e,t,r){tl(e,t),r.length>0&&(e.i=null,e.g.set(tf(e,t),_(r)),e.h+=r.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tg(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tp(){this.g=new ed}function tm(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){en.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function t_(e){let t="";return q(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=t_(r),"string"==typeof e?null!=r&&eR(r):e8(e,t,r))}function tE(e){en.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eR(r);r=th(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eR(r[t])),e.push(n)}}return this.i=e.join("&")},v(tm,ef),tm.prototype.g=function(){return new ty(this.i,this.h)},v(ty,en),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||g).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tE,en);var tT=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tk(e)}function tC(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tA(e){if(e.h&&void 0!==f){if(e.v&&4==tD(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tD(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(e0)[1]||null;!t&&g.self&&g.self.location&&(t=g.self.location.protocol.slice(0,-1)),r=!tT.test(t?t.toLowerCase():"")}t=r}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tD(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||ei(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tD(e){return e.g?e.g.readyState:0}function tN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new eC,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eQ(e&&e.concurrentRequestLimit),this.Ba=new tp,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tM(e){if(tP(e),3==e.I){var t=e.V++,r=e2(e.J);if(e8(r,"SID",e.M),e8(r,"RID",t),e8(r,"TYPE","terminate"),tU(e,r),(t=new eO(e,e.j,t)).M=2,t.A=e4(e2(r)),r=!1,g.navigator&&g.navigator.sendBeacon)try{r=g.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&g.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eB(t)}tW(e)}function tL(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tP(e){tL(e),e.v&&(g.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&g.clearTimeout(e.m),e.m=null)}function tF(e){if(!eH(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||A(),x||(S(),x=!0),C.add(t,e),e.D=0}}function tV(e,t){var r;r=t?t.l:e.V++;let n=e2(e.J);e8(n,"SID",e.M),e8(n,"RID",r),e8(n,"AID",e.K),tU(e,n),e.u&&e.o&&tI(n,e.u,e.o),r=new eO(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tB(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eY(e.h,r),eF(r,n,t)}function tU(e,t){e.H&&q(e.H,function(e,r){e8(t,r,e)}),e.l&&q({},function(e,r){e8(t,r,e)})}function tB(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<r;l++){var s=i[l].g;let r=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;p(r)&&(n=eh(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||A(),x||(S(),x=!0),C.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=ex(y(e.Da,e),tQ(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(g.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new eO(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e8(t,"RID","rpc"),e8(t,"SID",e.M),e8(t,"AID",e.K),e8(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e8(t,"TO",e.ia),e8(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tI(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e4(e2(t)),r.u=null,r.R=!0,eV(r,e)}function tK(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function tG(e,t){var r,n=null;if(e.g==t){tK(e),tz(e),e.g=null;var i=2}else{if(!eJ(e.h,t))return;n=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=eb(),new eS(i,n)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eW(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=ex(y(e.Ea,e,r),tQ(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tQ(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var r,n=y(e.bb,e),i=e.Ua;let o=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||e5(i,"https"),e4(i),o?function(e,t){let r=new eC;if(g.Image){let n=new Image;n.onload=w(tg,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(tg,r,"TestLoadImage: error",!1,t,n),n.onabort=w(tg,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(tg,r,"TestLoadImage: timeout",!1,t,n),g.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eC,s=new AbortController,a=setTimeout(()=>{s.abort(),tg(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tg(t,"TestPingServer: ok",!0,n):tg(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(a),tg(t,"TestPingServer: error",!1,n)}))}else eT(2);e.I=0,e.l&&e.l.pa(t),tW(e),tP(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof e1?e2(r):new e1(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e6(n,n.u);else{var i=g.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);n&&e5(e,n),t&&(e.g=t),i&&e6(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e8(n,r,t),e8(n,"VER",e.ka),tU(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tm({ab:r}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){en.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!L(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!L(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){em.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){ey.call(this),this.status=1}function t5(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&t instanceof g.FormData,!(Array.prototype.indexOf.call(tS,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tD(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eT(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eO(this,this.j,e),s=this.o;if(this.U&&(s?$(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tB(this,i,t),e8(r=e2(this.J),"RID",e),e8(r,"CVER",22),this.G&&e8(r,"X-HTTP-Session-Id",this.G),tU(this,r),s&&(this.R?t="headers="+eR(t_(s))+"&"+t:this.u&&tI(r,this.u,s)),eY(this.h,i),this.Ra&&e8(r,"TYPE","init"),this.S?(e8(r,"$req",t),e8(r,"SID","null"),i.U=!0,eF(i,r,null)):eF(i,r,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eH(this.h)||tV(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ex(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eT(10),tL(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tL(this),tj(this),eT(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eT(2)):(this.j.info("Failed to ping google.com"),eT(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,en),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tM(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=eh(e),e=r);t.i.push(new eG(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,t0.Z.N.call(this)},v(t1,em),v(t2,ey),v(t5,tX),t5.prototype.ra=function(){ei(this.g,"a")},t5.prototype.qa=function(e){ei(this.g,new t1(e))},t5.prototype.pa=function(e){ei(this.g,new t2)},t5.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,d=N.createWebChannelTransport=function(){return new tZ},c=N.getStatEventTarget=function(){return eb()},h=N.Event=ew,u=N.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ek.NO_ERROR=0,ek.TIMEOUT=8,ek.HTTP_ERROR=6,l=N.ErrorCode=ek,eD.COMPLETE="complete",o=N.EventType=eD,eg.EventType=ep,ep.OPEN="a",ep.CLOSE="b",ep.ERROR="c",ep.MESSAGE="d",en.prototype.listen=en.prototype.J,a=N.WebChannel=eg,N.FetchXmlHttpFactory=tm,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,s=N.XhrIo=tE}).apply(void 0!==D?D:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});class R{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}R.UNAUTHENTICATED=new R(null),R.GOOGLE_CREDENTIALS=new R("google-credentials-uid"),R.FIRST_PARTY=new R("first-party-uid"),R.MOCK_USER=new R("mock-user");let O="12.9.0",M=new k.Logger("@firebase/firestore");function L(){return M.logLevel}function P(e,...t){if(M.logLevel<=k.LogLevel.DEBUG){let r=t.map(U);M.debug(`Firestore (${O}): ${e}`,...r)}}function F(e,...t){if(M.logLevel<=k.LogLevel.ERROR){let r=t.map(U);M.error(`Firestore (${O}): ${e}`,...r)}}function V(e,...t){if(M.logLevel<=k.LogLevel.WARN){let r=t.map(U);M.warn(`Firestore (${O}): ${e}`,...r)}}function U(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function B(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,q(e,n,r)}function q(e,t,r){let n=`FIRESTORE (${O}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw F(n),Error(n)}function j(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||q(t,i,n)}let z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $ extends x.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class K{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class G{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Q{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(R.UNAUTHENTICATED))}shutdown(){}}class H{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class W{constructor(e){this.t=e,this.currentUser=R.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){j(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new K;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new K,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{P("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(P("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new K)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(P("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(j("string"==typeof t.accessToken,31837,{l:t}),new G(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return j(null===e||"string"==typeof e,2055,{h:e}),new R(e)}}class J{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=R.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Y{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new J(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(R.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class X{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,v._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){j(void 0===this.o,3512);let r=e=>{null!=e.error&&P("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,P("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{P("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):P("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new X(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(j("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new X(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class ee{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function et(e,t){return e<t?-1:+(e>t)}function er(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return en(r)===en(i)?et(r,i):en(r)?1:-1}return et(e.length,t.length)}function en(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function ei(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let es="__name__";class ea{constructor(e,t,r){void 0===t?t=0:t>e.length&&B(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&B(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ea.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ea?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=ea.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return et(e.length,t.length)}static compareSegments(e,t){let r=ea.isNumericId(e),n=ea.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ea.extractNumericId(e).compare(ea.extractNumericId(t)):er(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return n.fromString(e.substring(4,e.length-2))}}class eo extends ea{construct(e,t,r){return new eo(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new $(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new eo(t)}static emptyPath(){return new eo([])}}let el=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eu extends ea{construct(e,t,r){return new eu(e,t,r)}static isValidIdentifier(e){return el.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eu.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===es}static keyField(){return new eu([es])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new $(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new $(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new $(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new $(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eu(t)}static emptyPath(){return new eu([])}}class eh{constructor(e){this.path=e}static fromPath(e){return new eh(eo.fromString(e))}static fromName(e){return new eh(eo.fromString(e).popFirst(5))}static empty(){return new eh(eo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===eo.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return eo.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new eh(new eo(e.slice()))}}function ec(e,t,r){if(!r)throw new $(z.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ed(e){if(!eh.isDocumentKey(e))throw new $(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ef(e){if(eh.isDocumentKey(e))throw new $(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function eg(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ep(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":B(12329,{type:typeof e})}function em(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new $(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ep(e);throw new $(z.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function ey(e,t){if(t<=0)throw new $(z.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ew(e,t){let r={typeString:e};return t&&(r.value=t),r}function ev(e,t){let r;if(!eg(e))throw new $(z.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new $(z.INVALID_ARGUMENT,r);return!0}class eb{static now(){return eb.fromMillis(Date.now())}static fromDate(e){return eb.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new eb(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new $(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new $(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?et(this.nanoseconds,e.nanoseconds):et(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:eb._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ev(e,eb._jsonSchema))return new eb(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}eb._jsonSchemaVersion="firestore/timestamp/1.0",eb._jsonSchema={type:ew("string",eb._jsonSchemaVersion),seconds:ew("number"),nanoseconds:ew("number")};class e_{static fromTimestamp(e){return new e_(e)}static min(){return new e_(new eb(0,0))}static max(){return new e_(new eb(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class eI{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function eE(e){return e.fields.find(e=>2===e.kind)}function eT(e){return e.fields.filter(e=>2!==e.kind)}function eS(e,t){let r=et(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=eu.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:et(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return et(e.fields.length,t.fields.length)}eI.UNKNOWN_ID=-1;class ex{constructor(e,t){this.fieldPath=e,this.kind=t}}class eC{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eC(0,eD.min())}}function eA(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new eD(e_.fromTimestamp(1e9===n?new eb(r+1,0):new eb(r,n)),eh.empty(),t)}function ek(e){return new eD(e.readTime,e.key,-1)}class eD{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new eD(e_.min(),eh.empty(),-1)}static max(){return new eD(e_.max(),eh.empty(),-1)}}function eN(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=eh.comparator(e.documentKey,t.documentKey))?r:et(e.largestBatchId,t.largestBatchId)}let eR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eM(e){if(e.code!==z.FAILED_PRECONDITION||e.message!==eR)throw e;P("LocalStore","Unexpectedly lost primary lease")}class eL{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eL((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eL?t:eL.resolve(t)}catch(e){return eL.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eL.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eL.reject(t)}static resolve(e){return new eL((t,r)=>{t(e)})}static reject(e){return new eL((t,r)=>{r(e)})}static waitFor(e){return new eL((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=eL.resolve(!1);for(let r of e)t=t.next(e=>e?eL.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eL((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new eL((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let eP="SimpleDb";class eF{static open(e,t,r,n){try{return new eF(t,e.transaction(n,r))}catch(e){throw new eq(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new K,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eq(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=eG(t.target.error);this.S.reject(new eq(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(P(eP,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new ez(this.transaction.objectStore(e))}}class eV{static delete(e){return P(eP,"Removing database:",e),e$((0,x.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,x.isIndexedDBAvailable)())return!1;if(eV.F())return!0;let e=(0,x.getUA)(),t=eV.M(e),r=eU(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==T.default&&"YES"===T.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===eV.M((0,x.getUA)())&&F("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(P(eP,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new eq(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new $(z.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new $(z.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new eq(e,n))},n.onupgradeneeded=e=>{P(eP,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{P(eP,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=eF.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),eL.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(P(eP,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eU(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eB{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return e$(this.U.delete())}}class eq extends ${constructor(e,t){super(z.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ej(e){return"IndexedDbTransactionError"===e.name}class ez{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(P(eP,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(P(eP,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),e$(r)}add(e){return P(eP,"ADD",this.store.name,e,e),e$(this.store.add(e))}get(e){return e$(this.store.get(e)).next(t=>(void 0===t&&(t=null),P(eP,"GET",this.store.name,e,t),t))}delete(e){return P(eP,"DELETE",this.store.name,e),e$(this.store.delete(e))}count(){return P(eP,"COUNT",this.store.name),e$(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new eL((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new eL((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){P(eP,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new eL((r,n)=>{t.onerror=e=>{n(eG(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new eL((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new eB(i),a=t(i.primaryKey,i.value,s);if(a instanceof eL){let e=a.catch(e=>(s.done(),eL.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>eL.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function e$(e){return new eL((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(eG(e.target.error))}})}let eK=!1;function eG(e){let t=eV.M((0,x.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new $("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eK||(eK=!0,setTimeout(()=>{throw e},0)),e}}return e}let eQ="IndexBackfiller";class eH{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){P(eQ,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();P(eQ,`Documents written: ${e}`)}catch(e){ej(e)?P(eQ,"Ignoring IndexedDB error during index backfill: ",e):await eM(e)}await this.re(6e4)})}}class eW{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return eL.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return P(eQ,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(P(eQ,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=ek(t);eN(n,r)>0&&(r=n)}),new eD(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eJ{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function eY(e){return null==e}function eX(e){return 0===e&&1/e==-1/0}function eZ(e){return"number"==typeof e&&Number.isInteger(e)&&!eX(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function e0(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}eJ.ce=-1;function e1(e){let t=e.length;if(j(t>=2,64408,{path:e}),2===t)return j("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),eo.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&B(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:B(61167,{path:e})}s=t+2}return new eo(n)}let e2="remoteDocuments",e5="owner",e6="owner",e3="mutationQueues",e8="mutations",e4="batchId",e9="userMutationsIndex",e7=["userId","batchId"],te={},tt="documentMutations",tr="remoteDocumentsV14",tn=["prefixPath","collectionGroup","readTime","documentId"],ti="documentKeyIndex",ts=["prefixPath","collectionGroup","documentId"],ta="collectionGroupIndex",to=["collectionGroup","readTime","prefixPath","documentId"],tl="remoteDocumentGlobal",tu="remoteDocumentGlobalKey",th="targets",tc="queryTargetsIndex",td=["canonicalId","targetId"],tf="targetDocuments",tg=["targetId","path"],tp="documentTargetsIndex",tm=["path","targetId"],ty="targetGlobalKey",tw="targetGlobal",tv="collectionParents",tb=["collectionId","parent"],t_="clientMetadata",tI="bundles",tE="namedQueries",tT="indexConfiguration",tS="collectionGroupIndex",tx="indexState",tC=["indexId","uid"],tA="sequenceNumberIndex",tk=["uid","sequenceNumber"],tD="indexEntries",tN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tR="documentKeyIndex",tO=["indexId","uid","orderedDocumentKey"],tM="documentOverlays",tL=["userId","collectionPath","documentId"],tP="collectionPathOverlayIndex",tF=["userId","collectionPath","largestBatchId"],tV="collectionGroupOverlayIndex",tU=["userId","collectionGroup","largestBatchId"],tB="globals",tq=[e3,e8,tt,e2,th,e5,tw,tf,t_,tl,tv,tI,tE],tj=[...tq,tM],tz=[e3,e8,tt,tr,th,e5,tw,tf,t_,tl,tv,tI,tE,tM],t$=[...tz,tT,tx,tD],tK=[...t$,tB];class tG extends eO{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function tQ(e,t){return eV.O(e.le,t)}function tH(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function tW(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function tJ(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tY{constructor(e,t){this.comparator=e,this.root=t||tZ.EMPTY}insert(e,t){return new tY(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tZ.BLACK,null,null))}remove(e){return new tY(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tZ.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tX(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tX(this.root,e,this.comparator,!1)}getReverseIterator(){return new tX(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tX(this.root,e,this.comparator,!0)}}class tX{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tZ{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:tZ.RED,this.left=null!=n?n:tZ.EMPTY,this.right=null!=i?i:tZ.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new tZ(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return tZ.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return tZ.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tZ.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tZ.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw B(27949);return e+ +!this.isRed()}}tZ.EMPTY=null,tZ.RED=!0,tZ.BLACK=!1,tZ.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new tZ(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class t0{constructor(e){this.comparator=e,this.data=new tY(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new t1(this.data.getIterator())}getIteratorFrom(e){return new t1(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof t0)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new t0(this.comparator);return t.data=e,t}}class t1{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function t2(e){return e.hasNext()?e.getNext():void 0}class t5{constructor(e){this.fields=e,e.sort(eu.comparator)}static empty(){return new t5([])}unionWith(e){let t=new t0(eu.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new t5(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ei(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class t6 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class t3{constructor(e){this.binaryString=e}static fromBase64String(e){return new t3(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new t6("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new t3(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return et(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}t3.EMPTY_BYTE_STRING=new t3("");let t8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function t4(e){if(j(!!e,39018),"string"==typeof e){let t=0,r=t8.exec(e);if(j(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:t9(e.seconds),nanos:t9(e.nanos)}}function t9(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function t7(e){return"string"==typeof e?t3.fromBase64String(e):t3.fromUint8Array(e)}let re="server_timestamp",rt="__type__",rr="__previous_value__",rn="__local_write_time__";function ri(e){return(e?.mapValue?.fields||{})[rt]?.stringValue===re}function rs(e){let t=e.mapValue.fields[rr];return ri(t)?rs(t):t}function ra(e){let t=t4(e.mapValue.fields[rn].timestampValue);return new eb(t.seconds,t.nanos)}class ro{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let rl="(default)";class ru{constructor(e,t){this.projectId=e,this.database=t||rl}static empty(){return new ru("","")}get isDefaultDatabase(){return this.database===rl}isEqual(e){return e instanceof ru&&e.projectId===this.projectId&&e.database===this.database}}let rh="__type__",rc="__max__",rd={mapValue:{fields:{__type__:{stringValue:rc}}}},rf="__vector__",rg="value",rp={nullValue:"NULL_VALUE"};function rm(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ri(e)?4:rN(e)?0x1fffffffffffff:rk(e)?10:11:B(28295,{value:e})}function ry(e,t){if(e===t)return!0;let r=rm(e);if(r!==rm(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ra(e).isEqual(ra(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=t4(e.timestampValue),i=t4(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return t7(e.bytesValue).isEqual(t7(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return t9(e.geoPointValue.latitude)===t9(t.geoPointValue.latitude)&&t9(e.geoPointValue.longitude)===t9(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return t9(e.integerValue)===t9(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=t9(e.doubleValue),n=t9(t.doubleValue);return r===n?eX(r)===eX(n):isNaN(r)&&isNaN(n)}return!1;case 9:return ei(e.arrayValue.values||[],t.arrayValue.values||[],ry);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tH(s)!==tH(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!ry(s[e],a[e])))return!1;return!0;default:return B(52216,{left:e})}}function rw(e,t){return void 0!==(e.values||[]).find(e=>ry(e,t))}function rv(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=rm(e),u=rm(t);if(l!==u)return et(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return et(e.booleanValue,t.booleanValue);case 2:let h,c;return h=t9(e.integerValue||e.doubleValue),h<(c=t9(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return rb(e.timestampValue,t.timestampValue);case 4:return rb(ra(e),ra(t));case 5:return er(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=t7(r),f=t7(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=et(r[e],n[e]);if(0!==t)return t}return et(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let g;return i=e.geoPointValue,s=t.geoPointValue,0!==(g=et(t9(i.latitude),t9(s.latitude)))?g:et(t9(i.longitude),t9(s.longitude));case 9:return r_(e.arrayValue,t.arrayValue);case 10:let p,m,y,w,v;return a=e.mapValue,o=t.mapValue,p=a.fields||{},m=o.fields||{},y=p[rg]?.arrayValue,w=m[rg]?.arrayValue,0!==(v=et(y?.values?.length||0,w?.values?.length||0))?v:r_(y,w);case 11:return function(e,t){if(e===rd.mapValue&&t===rd.mapValue)return 0;if(e===rd.mapValue)return 1;if(t===rd.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=er(n[e],s[e]);if(0!==t)return t;let a=rv(r[n[e]],i[s[e]]);if(0!==a)return a}return et(n.length,s.length)}(e.mapValue,t.mapValue);default:throw B(23264,{he:l})}}function rb(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return et(e,t);let r=t4(e),n=t4(t),i=et(r.seconds,n.seconds);return 0!==i?i:et(r.nanos,n.nanos)}function r_(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=rv(r[e],n[e]);if(t)return t}return et(r.length,n.length)}function rI(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=t4(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?t7(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,eh.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=rI(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${rI(e.fields[i])}`;return r+"}"}(e.mapValue):B(61005,{value:e})}function rE(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rT(e){return!!e&&"integerValue"in e}function rS(e){return!!e&&"arrayValue"in e}function rx(e){return!!e&&"nullValue"in e}function rC(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function rA(e){return!!e&&"mapValue"in e}function rk(e){return(e?.mapValue?.fields||{})[rh]?.stringValue===rf}function rD(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return tW(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=rD(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=rD(e.arrayValue.values[r]);return t}return{...e}}function rN(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rc}let rR={mapValue:{fields:{[rh]:{stringValue:rf},[rg]:{arrayValue:{}}}}};function rO(e,t){let r=rv(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function rM(e,t){let r=rv(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class rL{constructor(e){this.value=e}static empty(){return new rL({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!rA(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rD(t)}setAll(e){let t=eu.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=rD(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());rA(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ry(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];rA(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(tW(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new rL(rD(this.value))}}class rP{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rP(e,0,e_.min(),e_.min(),e_.min(),rL.empty(),0)}static newFoundDocument(e,t,r,n){return new rP(e,1,t,e_.min(),r,n,0)}static newNoDocument(e,t){return new rP(e,2,t,e_.min(),e_.min(),rL.empty(),0)}static newUnknownDocument(e,t){return new rP(e,3,t,e_.min(),e_.min(),rL.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(e_.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rL.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rL.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=e_.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rP&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rP(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rF{constructor(e,t){this.position=e,this.inclusive=t}}function rV(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?eh.comparator(eh.fromName(a.referenceValue),r.key):rv(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function rU(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!ry(e.position[r],t.position[r]))return!1;return!0}class rB{constructor(e,t="asc"){this.field=e,this.dir=t}}class rq{}class rj extends rq{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rW(e,t,r):"array-contains"===t?new rZ(e,r):"in"===t?new r0(e,r):"not-in"===t?new r1(e,r):"array-contains-any"===t?new r2(e,r):new rj(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new rJ(e,r):new rY(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rv(t,this.value)):null!==t&&rm(this.value)===rm(t)&&this.matchesComparison(rv(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rz extends rq{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new rz(e,t)}matches(e){return r$(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function r$(e){return"and"===e.op}function rK(e){return"or"===e.op}function rG(e){return rQ(e)&&r$(e)}function rQ(e){for(let t of e.filters)if(t instanceof rz)return!1;return!0}function rH(e,t){let r=e.filters.concat(t);return rz.create(r,e.op)}class rW extends rj{constructor(e,t,r){super(e,t,r),this.key=eh.fromName(r.referenceValue)}matches(e){let t=eh.comparator(e.key,this.key);return this.matchesComparison(t)}}class rJ extends rj{constructor(e,t){super(e,"in",t),this.keys=rX("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rY extends rj{constructor(e,t){super(e,"not-in",t),this.keys=rX("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rX(e,t){return(t.arrayValue?.values||[]).map(e=>eh.fromName(e.referenceValue))}class rZ extends rj{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rS(t)&&rw(t.arrayValue,this.value)}}class r0 extends rj{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&rw(this.value.arrayValue,t)}}class r1 extends rj{constructor(e,t){super(e,"not-in",t)}matches(e){if(rw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!rw(this.value.arrayValue,t)}}class r2 extends rj{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rS(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>rw(this.value.arrayValue,e))}}class r5{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function r6(e,t=null,r=[],n=[],i=null,s=null,a=null){return new r5(e,t,r,n,i,s,a)}function r3(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rj)return t.field.canonicalString()+t.op.toString()+rI(t.value);if(rG(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),eY(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rI(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rI(e)).join(",")),e.Te=t}return e.Te}function r8(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof rj?r instanceof rj&&t.op===r.op&&t.field.isEqual(r.field)&&ry(t.value,r.value):t instanceof rz?r instanceof rz&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void B(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rU(e.startAt,t.startAt)&&rU(e.endAt,t.endAt)}function r4(e){return eh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function r9(e,t){return e.filters.filter(e=>e instanceof rj&&e.field.isEqual(t))}function r7(e,t,r){let n=rp,i=!0;for(let r of r9(e,t)){let e=rp,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?rp:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?rE(ru.empty(),eh.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?rk(s)?rR:{mapValue:{}}:B(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=rp}0>rO({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>rO({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ne(e,t,r){let n=rd,i=!0;for(let r of r9(e,t)){let e=rd,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?rE(ru.empty(),eh.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?rR:"mapValue"in s?rk(s)?{mapValue:{}}:rd:B(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rd}rM({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];rM({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class nt{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function nr(e){return new nt(e)}function nn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ni(e){return null!==e.collectionGroup}function ns(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new t0(eu.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new rB(t,n))}),r.has(eu.keyField().canonicalString())||e.Ie.push(new rB(eu.keyField(),n))}return e.Ie}function na(e){return e.Ee||(e.Ee=no(e,ns(e))),e.Ee}function no(e,t){if("F"===e.limitType)return r6(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rB(e.field,t)});let r=e.endAt?new rF(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new rF(e.startAt.position,e.startAt.inclusive):null;return r6(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function nl(e,t){let r=e.filters.concat([t]);return new nt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function nu(e,t,r){return new nt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nh(e,t){return r8(na(e),na(t))&&e.limitType===t.limitType}function nc(e){return`${r3(na(e))}|lt:${e.limitType}`}function nd(e){var t;let r;return`Query(target=${r=(t=na(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rj?`${t.field.canonicalString()} ${t.op} ${rI(t.value)}`:t instanceof rz?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),eY(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rI(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rI(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function nf(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):eh.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of ns(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=rV(i,ns(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=rV(s,ns(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function ng(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function np(e){return(t,r)=>{let n=!1;for(let i of ns(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?eh.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?rv(i,s):B(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return B(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class nm{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){tW(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return tJ(this.inner)}size(){return this.innerSize}}let ny=new tY(eh.comparator),nw=new tY(eh.comparator);function nv(...e){let t=nw;for(let r of e)t=t.insert(r.key,r);return t}function nb(e){let t=nw;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function n_(){return new nm(e=>e.toString(),(e,t)=>e.isEqual(t))}let nI=new tY(eh.comparator),nE=new t0(eh.comparator);function nT(...e){let t=nE;for(let r of e)t=t.add(r);return t}let nS=new t0(et);function nx(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eX(t)?"-0":t}}function nC(e){return{integerValue:""+e}}class nA{constructor(){this._=void 0}}function nk(e,t){return e instanceof nL?rT(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class nD extends nA{}class nN extends nA{constructor(e){super(),this.elements=e}}function nR(e,t){let r=nF(t);for(let t of e.elements)r.some(e=>ry(e,t))||r.push(t);return{arrayValue:{values:r}}}class nO extends nA{constructor(e){super(),this.elements=e}}function nM(e,t){let r=nF(t);for(let t of e.elements)r=r.filter(e=>!ry(e,t));return{arrayValue:{values:r}}}class nL extends nA{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function nP(e){return t9(e.integerValue||e.doubleValue)}function nF(e){return rS(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nV{constructor(e,t){this.field=e,this.transform=t}}class nU{constructor(e,t){this.version=e,this.transformResults=t}}class nB{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new nB}static exists(e){return new nB(void 0,e)}static updateTime(e){return new nB(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nq(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nj{}function nz(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new nY(e.key,nB.none()):new nG(e.key,e.data,nB.none());{let r=e.data,n=rL.empty(),i=new t0(eu.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new nQ(e.key,n,new t5(i.toArray()),nB.none())}}function n$(e,t,r,n){return e instanceof nG?function(e,t,r,n){if(!nq(e.precondition,t))return r;let i=e.value.clone(),s=nJ(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof nQ?function(e,t,r,n){if(!nq(e.precondition,t))return r;let i=nJ(e.fieldTransforms,n,t),s=t.data;return(s.setAll(nH(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):nq(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function nK(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&ei(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof nN&&n instanceof nN||r instanceof nO&&n instanceof nO?ei(r.elements,n.elements,ry):r instanceof nL&&n instanceof nL?ry(r.Ae,n.Ae):r instanceof nD&&n instanceof nD)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class nG extends nj{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class nQ extends nj{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nH(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function nW(e,t,r){let n=new Map;j(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof nN?nR(o,l):o instanceof nO?nM(o,l):i))}return n}function nJ(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof nD?(n=t,i={fields:{[rt]:{stringValue:re},[rn]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&ri(n)&&(n=rs(n)),n&&(i.fields[rr]=n),{mapValue:i}):e instanceof nN?nR(e,t):e instanceof nO?nM(e,t):(a=nP(s=nk(e,t))+nP(e.Ae),rT(s)&&rT(e.Ae)?nC(a):nx(e.serializer,a))}(e,s,t))}return n}class nY extends nj{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nX extends nj{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class nZ{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof nG?(n=e.value.clone(),i=nW(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof nQ?function(e,t,r){if(!nq(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=nW(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(nH(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=n$(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=n$(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=n_();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=nz(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(e_.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nT())}isEqual(e){return this.batchId===e.batchId&&ei(this.mutations,e.mutations,(e,t)=>nK(e,t))&&ei(this.baseMutations,e.baseMutations,(e,t)=>nK(e,t))}}class n0{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){j(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=nI,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new n0(e,t,r,n)}}class n1{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class n2{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class n5{constructor(e,t){this.count=e,this.unchangedNames=t}}function n6(e){switch(e){case z.OK:return B(64938);case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0;default:return B(15467,{code:e})}}function n3(e){if(void 0===e)return F("GRPC error has no .code"),z.UNKNOWN;switch(e){case f.OK:return z.OK;case f.CANCELLED:return z.CANCELLED;case f.UNKNOWN:return z.UNKNOWN;case f.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case f.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case f.INTERNAL:return z.INTERNAL;case f.UNAVAILABLE:return z.UNAVAILABLE;case f.UNAUTHENTICATED:return z.UNAUTHENTICATED;case f.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case f.NOT_FOUND:return z.NOT_FOUND;case f.ALREADY_EXISTS:return z.ALREADY_EXISTS;case f.PERMISSION_DENIED:return z.PERMISSION_DENIED;case f.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case f.ABORTED:return z.ABORTED;case f.OUT_OF_RANGE:return z.OUT_OF_RANGE;case f.UNIMPLEMENTED:return z.UNIMPLEMENTED;case f.DATA_LOSS:return z.DATA_LOSS;default:return B(39323,{code:e})}}(g=f||(f={}))[g.OK=0]="OK",g[g.CANCELLED=1]="CANCELLED",g[g.UNKNOWN=2]="UNKNOWN",g[g.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",g[g.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",g[g.NOT_FOUND=5]="NOT_FOUND",g[g.ALREADY_EXISTS=6]="ALREADY_EXISTS",g[g.PERMISSION_DENIED=7]="PERMISSION_DENIED",g[g.UNAUTHENTICATED=16]="UNAUTHENTICATED",g[g.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",g[g.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",g[g.ABORTED=10]="ABORTED",g[g.OUT_OF_RANGE=11]="OUT_OF_RANGE",g[g.UNIMPLEMENTED=12]="UNIMPLEMENTED",g[g.INTERNAL=13]="INTERNAL",g[g.UNAVAILABLE=14]="UNAVAILABLE",g[g.DATA_LOSS=15]="DATA_LOSS";let n8=null;function n4(){return new TextEncoder}let n9=new n([0xffffffff,0xffffffff],0);function n7(e){let t=n4().encode(e),r=new i;return r.update(t),new Uint8Array(r.digest())}function ie(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new n([r,i],0),new n([s,a],0)]}class it{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ir(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new ir(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ir(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=n.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(n.fromNumber(r)));return 1===i.compare(n9)&&(i=new n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=ie(n7(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new it(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=ie(n7(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ir extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ii{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,is.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ii(e_.min(),n,new tY(et),ny,nT())}}class is{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new is(r,t,nT(),nT(),nT())}}class ia{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class io{constructor(e,t){this.targetId=e,this.Ce=t}}class il{constructor(e,t,r=t3.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class iu{constructor(){this.ve=0,this.Fe=id(),this.Me=t3.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=nT(),t=nT(),r=nT();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:B(38017,{changeType:i})}}),new is(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=id()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,j(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class ih{constructor(e){this.Ge=e,this.ze=new Map,this.je=ny,this.He=ic(),this.Je=ic(),this.Ze=new tY(et)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:B(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(r4(a))if(0===r){let e=new eh(a.path);this.et(t,e,rP.newNoDocument(e,e_.min()))}else j(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),n8?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=t7(i).toUint8Array()}catch(e){if(e instanceof t6)return V("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new it(t,s,a)}catch(e){return V(e instanceof ir?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&r4(i.target)){let t=new eh(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,rP.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=nT();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new ii(e,t,this.Ze,this.je,r);return this.je=ny,this.He=ic(),this.Je=ic(),this.Ze=new tY(et),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new iu,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new t0(et),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new t0(et),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||P("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new iu),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ic(){return new tY(eh.comparator)}function id(){return new tY(eh.comparator)}let ig={asc:"ASCENDING",desc:"DESCENDING"},ip={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},im={and:"AND",or:"OR"};class iy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iw(e,t){return e.useProto3Json||eY(t)?t:{value:t}}function iv(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ib(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function i_(e){let t;return j(!!e,49232),e_.fromTimestamp(new eb((t=t4(e)).seconds,t.nanos))}function iI(e,t){return iE(e,t).canonicalString()}function iE(e,t){let r=new eo(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function iT(e){let t=eo.fromString(e);return j(iB(t),10190,{key:t.toString()}),t}function iS(e,t){return iI(e.databaseId,t.path)}function ix(e,t){let r=iT(t);if(r.get(1)!==e.databaseId.projectId)throw new $(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new $(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new eh(iD(r))}function iC(e,t){return iI(e.databaseId,t)}function iA(e){let t=iT(e);return 4===t.length?eo.emptyPath():iD(t)}function ik(e){return new eo(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iD(e){return j(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iN(e,t,r){return{name:iS(e,t),fields:r.value.mapValue.fields}}function iR(e,t,r){let n=ix(e,t.name),i=i_(t.updateTime),s=t.createTime?i_(t.createTime):e_.min(),a=new rL({mapValue:{fields:t.fields}}),o=rP.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function iO(e,t){var r,n;let i;if(t instanceof nG)i={update:iN(e,t.key,t.value)};else if(t instanceof nY)i={delete:iS(e,t.key)};else if(t instanceof nQ){let r;i={update:iN(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof nX))return B(16599,{dt:t.type});i={verify:iS(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof nD)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof nN)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof nO)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof nL)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw B(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:iv(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:B(27497)),i}function iM(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?nB.updateTime(i_(r.updateTime)):void 0!==r.exists?nB.exists(r.exists):nB.none():nB.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(j("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new nD):"appendMissingElements"in t?r=new nN(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new nO(t.removeAllFromArray.values||[]):"increment"in t?r=new nL(e,t.increment):B(16584,{proto:t}),new nV(eu.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=ix(e,t.update.name),s=new rL({mapValue:{fields:t.update.fields}});return t.updateMask?new nQ(r,s,new t5((t.updateMask.fieldPaths||[]).map(e=>eu.fromServerFormat(e))),n,i):new nG(r,s,n,i)}return t.delete?new nY(ix(e,t.delete),n):t.verify?new nX(ix(e,t.verify),n):B(1463,{proto:t})}function iL(e,t){return{documents:[iC(e,t.path)]}}function iP(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iC(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof rj?function(e){if("=="===e.op){if(rC(e.value))return{unaryFilter:{field:iV(e.field),op:"IS_NAN"}};if(rx(e.value))return{unaryFilter:{field:iV(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rC(e.value))return{unaryFilter:{field:iV(e.field),op:"IS_NOT_NAN"}};if(rx(e.value))return{unaryFilter:{field:iV(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iV(e.field),op:ip[e.op],value:e.value}}}(t):t instanceof rz?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:im[r.op],filters:n}}:B(54877,{filter:t})}(rz.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:iV(e.field),direction:ig[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iw(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function iF(e){var t,r,n;let i,s,a,o,l=iA(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){j(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iU(e.unaryFilter.field);return rj.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=iU(e.unaryFilter.field);return rj.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=iU(e.unaryFilter.field);return rj.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iU(e.unaryFilter.field);return rj.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}}(t):void 0!==t.fieldFilter?rj.create(iU(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rz.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return B(1026)}}(t.compositeFilter.op)):B(30097,{filter:t})}(u.where))instanceof rz&&rG(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new rB(iU(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=eY(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let p=null;u.startAt&&(a=!!(r=u.startAt).before,p=new rF(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new rF(n.values||[],o)),new nt(l,c,f,d,g,"F",p,m)}function iV(e){return{fieldPath:e.canonicalString()}}function iU(e){return eu.fromServerFormat(e.fieldPath)}function iB(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function iq(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class ij{constructor(e,t,r,n,i=e_.min(),s=e_.min(),a=t3.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ij(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ij(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ij(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ij(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iz{constructor(e){this.yt=e}}function i$(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:iK(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:iS(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:iv(i,t.version.toTimestamp()),createTime:iv(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:iG(t.version)};else{if(!t.isUnknownDocument())return B(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:iG(t.version)}}return n}function iK(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iG(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iQ(e){let t=new eb(e.seconds,e.nanoseconds);return e_.fromTimestamp(t)}function iH(e,t){let r=(t.baseMutations||[]).map(t=>iM(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>iM(e.yt,t)),i=eb.fromMillis(t.localWriteTimeMs);return new nZ(t.batchId,i,r,n)}function iW(e){var t;let r,n=iQ(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?iQ(e.lastLimboFreeSnapshotVersion):e_.min();return new ij(void 0!==e.query.documents?(j(1===(r=(t=e.query).documents.length),1966,{count:r}),na(nr(iA(t.documents[0])))):na(iF(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,t3.fromBase64String(e.resumeToken))}function iJ(e,t){let r,n=iG(t.snapshotVersion),i=iG(t.lastLimboFreeSnapshotVersion);r=r4(t.target)?iL(e.yt,t.target):iP(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:r3(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function iY(e){let t=iF({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?nu(t,t.limit,"L"):t}function iX(e,t){return new n1(t.largestBatchId,iM(e.yt,t.overlayMutation))}function iZ(e,t){let r=t.path.lastSegment();return[e,e0(t.path.popLast()),r]}function i0(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:iG(n.readTime),documentKey:e0(n.documentKey.path),largestBatchId:n.largestBatchId}}class i1{getBundleMetadata(e,t){return tQ(e,tI).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iQ(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tQ(e,tI).put({bundleId:t.id,createTime:iG(i_(t.createTime)),version:t.version})}getNamedQuery(e,t){return tQ(e,tE).get(t).next(e=>{if(e)return{name:e.name,query:iY(e.bundledQuery),readTime:iQ(e.readTime)}})}saveNamedQuery(e,t){return tQ(e,tE).put({name:t.name,readTime:iG(i_(t.readTime)),bundledQuery:t.bundledQuery})}}class i2{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new i2(e,t.uid||"")}getOverlay(e,t){return tQ(e,tM).get(iZ(this.userId,t)).next(e=>e?iX(this.serializer,e):null)}getOverlays(e,t){let r=n_();return eL.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new n1(t,i);n.push(this.bt(e,s))}),eL.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(e0(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(tQ(e,tM).X(tP,n))}),eL.waitFor(i)}getOverlaysForCollection(e,t,r){let n=n_(),i=e0(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return tQ(e,tM).H(tP,s).next(e=>{for(let t of e){let e=iX(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=n_(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return tQ(e,tM).ee({index:tV,range:a},(e,t,r)=>{let a=iX(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return tQ(e,tM).put(function(e,t,r){let[n,i,s]=iZ(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:iO(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class i5{St(e){return tQ(e,tB)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?t3.fromUint8Array(t):t3.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class i6{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(t9(e.integerValue));else if("doubleValue"in e){let r=t9(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),eX(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=t4(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(t7(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rk(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):B(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[rg].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(t9(n)),this.Ot(rg,t),this.Ct(r[rg],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),eh.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function i3(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}i6.Wt=new i6;class i8{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=i3(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=i3(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class i4{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class i9{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class i7{constructor(){this.cn=new i8,this.ascending=new i4(this.cn),this.descending=new i9(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class se{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new se(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:sn(this.Tn),directionalValue:sn(this.In),orderedDocumentKey:sn(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function st(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=sr(e.Tn,t.Tn))||0!==(r=sr(e.In,t.In))?r:eh.comparator(e.Pn,t.Pn)}function sr(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function sn(e){return(0,x.isSafariOrWebkit)()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function si(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class ss{constructor(e){for(const t of(this.Vn=new t0((e,t)=>eu.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(j(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=eE(e);if(void 0!==t&&!this.pn(t))return!1;let r=eT(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new t0(eu.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new ex(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ex(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ex(r.field,+("asc"!==r.dir))));return new eI(eI.UNKNOWN_ID,this.collectionId,t,eC.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sa(e){return e instanceof rj}function so(e){return e instanceof rz&&rG(e)}function sl(e){return sa(e)||so(e)||function(e){if(e instanceof rz&&rK(e)){for(let t of e.getFilters())if(!sa(t)&&!so(t))return!1;return!0}return!1}(e)}function su(e,t){return j(e instanceof rj||e instanceof rz,38388),j(t instanceof rj||t instanceof rz,25473),sc(e instanceof rj?t instanceof rj?rz.create([e,t],"and"):sh(e,t):t instanceof rj?sh(t,e):function(e,t){if(j(e.filters.length>0&&t.filters.length>0,48005),r$(e)&&r$(t))return rH(e,t.getFilters());let r=rK(e)?e:t,n=rK(e)?t:e,i=r.filters.map(e=>su(e,n));return rz.create(i,"or")}(e,t))}function sh(e,t){if(r$(t))return rH(t,e.getFilters());{let r=t.filters.map(t=>su(e,t));return rz.create(r,"or")}}function sc(e){if(j(e instanceof rj||e instanceof rz,11850),e instanceof rj)return e;let t=e.getFilters();if(1===t.length)return sc(t[0]);if(rQ(e))return e;let r=t.map(e=>sc(e)),n=[];return r.forEach(t=>{t instanceof rj?n.push(t):t instanceof rz&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:rz.create(n,e.op)}class sd{constructor(){this.Sn=new sf}addToCollectionParentIndex(e,t){return this.Sn.add(t),eL.resolve()}getCollectionParents(e,t){return eL.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return eL.resolve()}deleteFieldIndex(e,t){return eL.resolve()}deleteAllFieldIndexes(e){return eL.resolve()}createTargetIndexes(e,t){return eL.resolve()}getDocumentsMatchingTarget(e,t){return eL.resolve(null)}getIndexType(e,t){return eL.resolve(0)}getFieldIndexes(e,t){return eL.resolve([])}getNextCollectionGroupToUpdate(e){return eL.resolve(null)}getMinOffset(e,t){return eL.resolve(eD.min())}getMinOffsetFromCollectionGroup(e,t){return eL.resolve(eD.min())}updateCollectionGroup(e,t,r){return eL.resolve()}updateIndexEntries(e,t){return eL.resolve()}}class sf{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new t0(eo.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new t0(eo.comparator)).toArray()}}let sg="IndexedDbIndexManager",sp=new Uint8Array(0);class sm{constructor(e,t){this.databaseId=t,this.Dn=new sf,this.Cn=new nm(e=>r3(e),(e,t)=>r8(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:e0(n)};return tQ(e,tv).put(i)}return eL.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tQ(e,tv).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(e1(n.parent))}return r})}addFieldIndex(e,t){let r=tQ(e,tT),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=tQ(e,tx);return i.next(e=>{r.put(i0(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=tQ(e,tT),n=tQ(e,tx),i=tQ(e,tD);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tQ(e,tT),r=tQ(e,tD),n=tQ(e,tx);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return eL.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new ss(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=tQ(e,tD),n=!0,i=new Map;return eL.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=nT(),n=[];return eL.forEach(i,(i,s)=>{P(sg,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${r3(t)}`);let a=function(e,t){let r=eE(t);if(void 0===r)return null;for(let t of r9(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of eT(t))for(let t of r9(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of eT(t)){let t=0===i.kind?r7(e,i.fieldPath,e.startAt):ne(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new rF(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of eT(t)){let t=0===i.kind?ne(e,i.fieldPath,e.endAt):r7(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new rF(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eL.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=eh.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return eL.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(j(t instanceof rj||t instanceof rz,34018),t instanceof rj)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=rz.create(r,t.op);return sl(n=sc(n))?n:(j(n instanceof rz,64498),j(r$(n),40251),j(n.filters.length>1,57927),n.filters.reduce((e,t)=>su(e,t)))}(function e(t){if(j(t instanceof rj||t instanceof rz,20012),t instanceof rj){if(t instanceof r0){let e=t.value.arrayValue?.values?.map(e=>rj.create(t.field,"==",e))||[];return rz.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return rz.create(r,t.op)}(e));return j(sl(t),7391),sa(t)||so(t)?[t]:t.getFilters()})(rz.create(e.filters,"and")).map(t=>r6(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):sp,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new se(e,eh.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new se(e,eh.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new ss(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return eL.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new t0(eu.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new i7;for(let n of eT(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);i6.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new i7;return i6.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new i7;return i6.Wt.Dt(rE(this.databaseId,t),n.ln(0===(r=eT(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new i7);let i=0;for(let s of eT(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&rS(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);i6.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new i7;n.seed(r.un()),i6.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof rj&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=tQ(e,tT),n=tQ(e,tx);return(t?r.H(tS,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return eL.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new eC(r.sequenceNumber,new eD(iQ(r.readTime),new eh(e1(r.documentKey)),r.largestBatchId)):eC.empty(),i=e.fields.map(([e,t])=>new ex(eu.fromServerFormat(e),t)),new eI(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:et(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=tQ(e,tT),i=tQ(e,tx);return this.Wn(e).next(e=>n.H(tS,IDBKeyRange.bound(t,t)).next(t=>eL.forEach(t,t=>i.put(i0(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return eL.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?eL.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eL.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?eL.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return tQ(e,tD).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return tQ(e,tD).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=tQ(e,tD),i=new t0(st);return n.ee({index:tR,range:IDBKeyRange.only([r.indexId,this.uid,sn(this.Kn(r,t))])},(e,n)=>{i=i.add(new se(r.indexId,t,si(n.arrayValue),si(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new t0(st),n=this.kn(t,e);if(null==n)return r;let i=eE(t);if(null!=i){let s=e.data.field(i.fieldPath);if(rS(s))for(let i of s.arrayValue.values||[])r=r.add(new se(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new se(t.indexId,e.key,sp,n));return r}zn(e,t,r,n,i){P(sg,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=t2(s),l=t2(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=t2(a)):t?(i(o),o=t2(s)):(o=t2(s),l=t2(a))}}(n,i,st,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),eL.waitFor(s)}Wn(e){let t=1;return tQ(e,tx).ee({index:tA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>st(e,t)).filter((e,t,r)=>!t||0!==st(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=st(i,e),s=st(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,sp,eh.empty()),r=n[e+1].An(this.uid,sp,eh.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return st(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sy)}getMinOffset(e,t){return eL.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||B(44426))).next(sy)}}function sy(e){j(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>eN(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new eD(t.readTime,t.documentKey,r)}let sw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sv{static withCacheSize(e){return new sv(e,sv.DEFAULT_COLLECTION_PERCENTILE,sv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function sb(e,t,r){let n=e.store(e8),i=e.store(tt),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{j(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,e0(h),c]);s.push(i.delete(n)),u.push(e.key)}return eL.waitFor(s).next(()=>u)}function s_(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw B(14731);t=e.noDocument}return JSON.stringify(t).length}sv.DEFAULT_COLLECTION_PERCENTILE=10,sv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sv.DEFAULT=new sv(0x2800000,sv.DEFAULT_COLLECTION_PERCENTILE,sv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sv.DISABLED=new sv(-1,0,0);class sI{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return j(""!==e.uid,64387),new sI(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sT(e).ee({index:e9,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=tQ(e,tt),s=sT(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;j("number"==typeof a,49019);let f=new nZ(a,t,r,n),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>iO(o.yt,e)),d=f.mutations.map(e=>iO(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),p=[],m=new t0((e,t)=>et(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,e0(h),a]);m=m.add(e.key.path.popLast()),p.push(s.put(g)),p.push(i.put(t,te))}return m.forEach(t=>{p.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),eL.waitFor(p).next(()=>f)})}lookupMutationBatch(e,t){return sT(e).get(t).next(e=>e?(j(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iH(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?eL.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return sT(e).ee({index:e9,range:n},(e,t,n)=>{t.userId===this.userId&&(j(t.batchId>=r,47524,{Yn:r}),i=iH(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return sT(e).ee({index:e9,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sT(e).H(e9,t).next(e=>e.map(e=>iH(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,e0(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return tQ(e,tt).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=e1(o);if(a===this.userId&&t.path.isEqual(u))return sT(e).get(l).next(e=>{if(!e)throw B(61480,{er:r,batchId:l});j(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(iH(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new t0(et),n=[];return t.forEach(t=>{let i=[this.userId,e0(t.path)],s=IDBKeyRange.lowerBound(i),a=tQ(e,tt).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=e1(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),eL.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,e0(r)],s=IDBKeyRange.lowerBound(i),a=new t0(et);return tQ(e,tt).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=e1(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(sT(e).get(t).next(e=>{if(null===e)throw B(35274,{batchId:t});j(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(iH(this.serializer,e))}))}),eL.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return sb(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),eL.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eL.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return tQ(e,tt).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=e1(e[1]);n.push(t)}else r.done()}).next(()=>{j(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return sE(e,this.userId,t)}ir(e){return tQ(e,e3).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sE(e,t,r){let n=[t,e0(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return tQ(e,tt).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function sT(e){return tQ(e,e8)}class sS{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new sS(0)}static ar(){return new sS(-1)}}class sx{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new sS(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>e_.fromTimestamp(new eb(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tQ(e,th).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(j(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return tQ(e,th).ee((s,a)=>{let o=iW(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>eL.waitFor(i)).next(()=>n)}forEachTarget(e,t){return tQ(e,th).ee((e,r)=>{t(iW(r))})}ur(e){return tQ(e,tw).get(ty).next(e=>(j(null!==e,2888),e))}cr(e,t){return tQ(e,tw).put(ty,t)}lr(e,t){return tQ(e,th).put(iJ(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=r3(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return tQ(e,th).ee({range:n,index:tc},(e,r,n)=>{let s=iW(r);r8(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=sC(e);return t.forEach(t=>{let s=e0(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),eL.waitFor(n)}removeMatchingKeys(e,t,r){let n=sC(e);return eL.forEach(t,t=>{let i=e0(t.path);return eL.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=sC(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=sC(e),i=nT();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new eh(e1(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=e0(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return sC(e).ee({index:tp,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return tQ(e,th).get(t).next(e=>e?iW(e):null)}}function sC(e){return tQ(e,tf)}let sA="LruGarbageCollector";function sk([e,t],[r,n]){let i=et(e,r);return 0===i?et(t,n):i}class sD{constructor(e){this.Pr=e,this.buffer=new t0(sk),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sk(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sN{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){P(sA,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ej(e)?P(sA,"Ignoring IndexedDB error during garbage collection: ",e):await eM(e)}await this.Ar(3e5)})}}class sR{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eL.resolve(eJ.ce);let r=new sD(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector","Garbage collection skipped; disabled"),eL.resolve(sw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sw):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(P("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),L()<=k.LogLevel.DEBUG&&P("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eL.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class sO{constructor(e,t){this.db=e,this.garbageCollector=new sR(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return sM(e,r)}removeReference(e,t,r){return sM(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return sM(e,t)}wr(e,t){let r;return r=!1,tQ(e,e3).te(n=>sE(e,n,t).next(e=>(e&&(r=!0),eL.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,e_.min()),sC(e).delete([0,e0(s.path)])))});n.push(t)}}).next(()=>eL.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return sM(e,t)}yr(e,t){let r=sC(e),n,i=eJ.ce;return r.ee({index:tp},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==eJ.ce&&t(new eh(e1(n)),i),i=a,n=s):i=eJ.ce}).next(()=>{i!==eJ.ce&&t(new eh(e1(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sM(e,t){var r;return sC(e).put((r=e.currentSequenceNumber,{targetId:0,path:e0(t.path),sequenceNumber:r}))}class sL{constructor(){this.changes=new nm(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rP.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?eL.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return tQ(e,tr).put(r)}removeEntry(e,t,r){let n;return tQ(e,tr).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],iK(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=rP.newInvalidDocument(t);return tQ(e,tr).ee({index:ti,range:IDBKeyRange.only(sV(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:rP.newInvalidDocument(t)};return tQ(e,tr).ee({index:ti,range:IDBKeyRange.only(sV(t))},(e,n)=>{r={document:this.Sr(t,n),size:s_(n)}}).next(()=>r)}getEntries(e,t){let r=ny;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=ny,n=new tY(eh.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,s_(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return eL.resolve();let n=new t0(sB);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(sV(n.first()),sV(n.last())),s=n.getIterator(),a=s.getNext();return tQ(e,tr).ee({index:ti,range:i},(e,t,n)=>{let i=eh.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sB(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(sV(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iK(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tQ(e,tr).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=ny;for(let i of e){let e=this.Sr(eh.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(nf(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=ny,s=sU(t,r),a=sU(t,eD.max());return tQ(e,tr).ee({index:ta,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(eh.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new sF(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tQ(e,tl).get(tu).next(e=>(j(!!e,20021),e))}br(e,t){return tQ(e,tl).put(tu,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=iR(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=eh.fromSegments(t.noDocument.path),r=iQ(t.noDocument.readTime);n=rP.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return B(56709);{let e=eh.fromSegments(t.unknownDocument.path),r=iQ(t.unknownDocument.version);n=rP.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new eb((r=t.readTime)[0],r[1]),e_.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(e_.min())))return e}return rP.newInvalidDocument(e)}}class sF extends sL{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new nm(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new t0((e,t)=>et(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=i$(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=s_(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=i$(this.Mr.serializer,s.convertToNoDocument(e_.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),eL.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function sV(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sU(e,t){let r=t.documentKey.path.toArray();return[e,iK(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function sB(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=et(r[e],n[e]))return i;return(i=et(r.length,n.length))||(i=et(r[r.length-2],n[n.length-2]))||et(r[r.length-1],n[n.length-1])}class sq{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sj{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&n$(r.mutation,e,t5.empty(),eb.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,nT()).next(()=>t))}getLocalViewOfDocuments(e,t,r=nT()){let n=n_();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=nv();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=n_();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,nT()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=ny,s=n_(),a=n_();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof nQ)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),n$(a.mutation,t,a.mutation.getFieldMask(),eb.now())):s.set(t.key,t5.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new sq(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=n_(),n=new tY((e,t)=>e-t),i=nT();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||t5.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||nT()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=n_();l.forEach(e=>{if(!i.has(e)){let n=nz(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eL.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return eh.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ni(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eL.resolve(n_()),a=-1,o=i;return s.next(t=>eL.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?eL.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,nT())).next(e=>({batchId:a,changes:nb(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new eh(t)).next(e=>{let t=nv();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=nv();return this.indexManager.getCollectionParents(e,i).next(a=>eL.forEach(a,a=>{let o=new nt(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,rP.newInvalidDocument(n)))});let r=nv();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&n$(s.mutation,n,t5.empty(),eb.now()),nf(t,n)&&(r=r.insert(e,n))}),r})}}class sz{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return eL.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:i_(t.createTime)}),eL.resolve()}getNamedQuery(e,t){return eL.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:iY(t.bundledQuery),readTime:i_(t.readTime)}),eL.resolve()}}class s${constructor(){this.overlays=new tY(eh.comparator),this.Lr=new Map}getOverlay(e,t){return eL.resolve(this.overlays.get(t))}getOverlays(e,t){let r=n_();return eL.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),eL.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),eL.resolve()}getOverlaysForCollection(e,t,r){let n=n_(),i=t.length+1,s=new eh(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eL.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new tY((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=n_(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=n_(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eL.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new n1(t,r));let i=this.Lr.get(t);void 0===i&&(i=nT(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class sK{constructor(){this.sessionToken=t3.EMPTY_BYTE_STRING}getSessionToken(e){return eL.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eL.resolve()}}class sG{constructor(){this.kr=new t0(sQ.Kr),this.qr=new t0(sQ.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new sQ(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new sQ(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new eh(new eo([])),r=new sQ(t,e),n=new sQ(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new eh(new eo([])),r=new sQ(t,e),n=new sQ(t,e+1),i=nT();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sQ(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class sQ{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return eh.comparator(e.key,t.key)||et(e.Hr,t.Hr)}static Ur(e,t){return et(e.Hr,t.Hr)||eh.comparator(e.key,t.key)}}class sH{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new t0(sQ.Kr)}checkEmpty(e){return eL.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new nZ(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new sQ(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eL.resolve(s)}lookupMutationBatch(e,t){return eL.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return eL.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return eL.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return eL.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new sQ(t,0),n=new sQ(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),eL.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new t0(et);return t.forEach(e=>{let t=new sQ(e,0),n=new sQ(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),eL.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;eh.isDocumentKey(i)||(i=i.child(""));let s=new sQ(new eh(i),0),a=new t0(et);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),eL.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){j(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return eL.forEach(t.mutations,n=>{let i=new sQ(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new sQ(t,0),n=this.Jr.firstAfterOrEqual(r);return eL.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eL.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sW{constructor(e){this.ti=e,this.docs=new tY(eh.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return eL.resolve(r?r.document.mutableCopy():rP.newInvalidDocument(t))}getEntries(e,t){let r=ny;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rP.newInvalidDocument(e))}),eL.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=ny,s=t.path,a=new eh(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eN(ek(a),r)||(n.has(a.key)||nf(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eL.resolve(i)}getAllFromCollectionGroup(e,t,r,n){B(9500)}ni(e,t){return eL.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sJ(this)}getSize(e){return eL.resolve(this.size)}}class sJ extends sL{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),eL.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class sY{constructor(e){this.persistence=e,this.ri=new nm(e=>r3(e),r8),this.lastRemoteSnapshotVersion=e_.min(),this.highestTargetId=0,this.ii=0,this.si=new sG,this.targetCount=0,this.oi=sS._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),eL.resolve()}getLastRemoteSnapshotVersion(e){return eL.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eL.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),eL.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),eL.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new sS(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,eL.resolve()}updateTargetData(e,t){return this.lr(t),eL.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,eL.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eL.waitFor(i).next(()=>n)}getTargetCount(e){return eL.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return eL.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),eL.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eL.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),eL.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return eL.resolve(r)}containsKey(e,t){return eL.resolve(this.si.containsKey(t))}}class sX{constructor(e,t){this._i={},this.overlays={},this.ai=new eJ(0),this.ui=!1,this.ui=!0,this.ci=new sK,this.referenceDelegate=e(this),this.li=new sY(this),this.indexManager=new sd,this.remoteDocumentCache=new sW(e=>this.referenceDelegate.hi(e)),this.serializer=new iz(t),this.Pi=new sz(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new s$,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new sH(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){P("MemoryPersistence","Starting transaction:",e);let n=new sZ(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return eL.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class sZ extends eO{constructor(e){super(),this.currentSequenceNumber=e}}class s0{constructor(e){this.persistence=e,this.Ri=new sG,this.Ai=null}static Vi(e){return new s0(e)}get di(){if(this.Ai)return this.Ai;throw B(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),eL.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),eL.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),eL.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eL.forEach(this.di,r=>{let n=eh.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,e_.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return eL.or([()=>eL.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class s1{constructor(e,t){this.persistence=e,this.fi=new nm(e=>e0(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sR(this,t)}static Vi(e,t){return new s1(e,t)}Ti(){}Ii(e){return eL.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return eL.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?eL.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,e_.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),eL.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eL.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eL.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),eL.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(rm(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=rs(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return t7(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,tW(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw B(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return eL.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return eL.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class s2{constructor(e){this.serializer=e}k(e,t,r,n){let i=new eF("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(e5),e.createObjectStore(e3,{keyPath:"userId"}),e.createObjectStore(e8,{keyPath:e4,autoIncrement:!0}).createIndex(e9,e7,{unique:!0}),e.createObjectStore(tt),s5(e),e.createObjectStore(e2));let s=eL.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(tf),e.deleteObjectStore(th),e.deleteObjectStore(tw),s5(e)),s=s.next(()=>{let e,t;return e=i.store(tw),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:e_.min().toTimestamp(),targetCount:0},e.put(ty,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(e8).H().next(t=>{e.deleteObjectStore(e8),e.createObjectStore(e8,{keyPath:e4,autoIncrement:!0}).createIndex(e9,e7,{unique:!0});let r=i.store(e8),n=t.map(e=>r.put(e));return eL.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(t_,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(tl),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(tI,{keyPath:"bundleId"}),e.createObjectStore(tE,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tM,{keyPath:tL})).createIndex(tP,tF,{unique:!1}),t.createIndex(tV,tU,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(tr,{keyPath:tn})).createIndex(ti,ts),t.createIndex(ta,to)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(e2))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(tT,{keyPath:"indexId",autoIncrement:!0}).createIndex(tS,"collectionGroup",{unique:!1}),e.createObjectStore(tx,{keyPath:tC}).createIndex(tA,tk,{unique:!1}),e.createObjectStore(tD,{keyPath:tN}).createIndex(tR,tO,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(tx).clear()}).next(()=>{t.objectStore(tD).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(tB,{keyPath:"name"})})),r<18&&n>=18&&(0,x.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(tx).clear()}).next(()=>{t.objectStore(tD).clear()})),s}pi(e){let t=0;return e.store(e2).ee((e,r)=>{t+=s_(r)}).next(()=>{let r={byteSize:t};return e.store(tl).put(tu,r)})}gi(e){let t=e.store(e3),r=e.store(e8);return t.H().next(t=>eL.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(e9,n).next(r=>eL.forEach(r,r=>{j(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=iH(this.serializer,r);return sb(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(tf),r=e.store(e2);return e.store(tw).get(ty).next(e=>{let n=[];return r.ee((r,i)=>{let s=new eo(r),a=[0,e0(s)];n.push(t.get(a).next(r=>r?eL.resolve():t.put({targetId:0,path:e0(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eL.waitFor(n))})}wi(e,t){e.createObjectStore(tv,{keyPath:tb});let r=t.store(tv),n=new sf,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:e0(n)})}};return t.store(e2).ee({Y:!0},(e,t)=>i(new eo(e).popLast())).next(()=>t.store(tt).ee({Y:!0},([e,t,r],n)=>i(e1(t).popLast())))}bi(e){let t=e.store(th);return t.ee((e,r)=>{let n=iW(r),i=iJ(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(e2),n=[];return r.ee((e,r)=>{let i=t.store(tr),s=(r.document?new eh(eo.fromString(r.document.name).popFirst(5)):r.noDocument?eh.fromSegments(r.noDocument.path):r.unknownDocument?eh.fromSegments(r.unknownDocument.path):B(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eL.waitFor(n))}Di(e,t){let r=t.store(e8),n=new sP(this.serializer),i=new sX(s0.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??nT();iH(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),eL.forEach(r,(e,r)=>{let s=new R(r),a=i2.wt(this.serializer,s),o=i.getIndexManager(s);return new sj(n,sI.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tG(t,eJ.ce),e).next()})})}}function s5(e){e.createObjectStore(tf,{keyPath:tg}).createIndex(tp,tm,{unique:!0}),e.createObjectStore(th,{keyPath:"targetId"}).createIndex(tc,td,{unique:!0}),e.createObjectStore(tw)}let s6="IndexedDbPersistence",s3="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class s8{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!s8.v())throw new $(z.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sO(this,n),this.Ki=t+"main",this.serializer=new iz(o),this.qi=new eV(this.Ki,this.xi,new s2(this.serializer)),this.ci=new i5,this.li=new sx(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sP(this.serializer),this.Pi=new i1,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&F(s6,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new $(z.FAILED_PRECONDITION,s3);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new eJ(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tQ(e,t_).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(ej(e))return P(s6,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return P(s6,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return tQ(e,e5).get(e6).next(e=>eL.resolve(this.Xi(e)))}Yi(e){return tQ(e,t_).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tQ(e,t_);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return eL.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?eL.resolve(!0):tQ(e,e5).get(e6).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new $(z.FAILED_PRECONDITION,s3);return!1}}return!(!this.networkEnabled||!this.inForeground)||tQ(e,t_).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&P(s6,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[e5,t_],e=>{let t=new tG(e,eJ.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>tQ(e,t_).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return sI.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sm(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return i2.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;P(s6,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?tK:16===n||15===n?t$:14===n||13===n?tz:12===n?tj:11===n?tq:void B(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new tG(n,this.ai?this.ai.next():eJ.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw F(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new $(z.FAILED_PRECONDITION,eR);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return tQ(e,e5).get(e6).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new $(z.FAILED_PRECONDITION,s3)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tQ(e,e5).put(e6,t)}static v(){return eV.v()}Ji(e){let t=tQ(e,e5);return t.get(e6).next(e=>this.Xi(e)?(P(s6,"Releasing primary lease."),t.delete(e6)):eL.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(F(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;(0,x.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return P(s6,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return F(s6,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){F("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function s4(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class s9{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=nT(),n=nT();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new s9(e,t.fromCache,r,n)}}class s7{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ae{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(0,x.isSafari)()?8:eU((0,x.getUA)())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new s7;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(L()<=k.LogLevel.DEBUG&&P("QueryEngine","SDK will not create cache indexes for query:",nd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),eL.resolve()):(L()<=k.LogLevel.DEBUG&&P("QueryEngine","Query:",nd(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(L()<=k.LogLevel.DEBUG&&P("QueryEngine","The SDK decides to create cache indexes for query:",nd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,na(t))):eL.resolve())}gs(e,t){if(nn(t))return eL.resolve(null);let r=na(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=na(t=nu(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=nT(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,nu(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return nn(t)||n.isEqual(e_.min())?eL.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?eL.resolve(null):(L()<=k.LogLevel.DEBUG&&P("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),nd(t)),this.Ds(e,s,t,eA(n,-1)).next(e=>e))})}bs(e,t){let r=new t0(np(e));return t.forEach((t,n)=>{nf(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return L()<=k.LogLevel.DEBUG&&P("QueryEngine","Using full collection scan to execute query:",nd(t)),this.fs.getDocumentsMatchingQuery(e,t,eD.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let at="LocalStore";class ar{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new tY(et),this.Fs=new nm(e=>r3(e),r8),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sj(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function an(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=nT();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function ai(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function as(e,t,r){let n=nT(),i=nT();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ny;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(e_.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):P(at,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function aa(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,eL.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new ij(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function ao(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!ej(e))throw e;P(at,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function al(e,t,r){let n=e_.min(),i=nT();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=na(t),void 0!==(o=e.Fs.get(a))?eL.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:e_.min(),r?i:nT())).next(r=>(ac(e,ng(t),r),{documents:r,ks:i}))})}function au(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function ah(e,t){let r=e.Ms.get(t)||e_.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,eA(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(ac(e,t,r),r))}function ac(e,t,r){let n=e.Ms.get(t)||e_.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function ad(e,t,r,n){let i=nT(),s=ny;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await aa(e,na(nr(eo.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>as(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function af(e,t,r=nT()){let n=await aa(e,na(iY(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=i_(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(t3.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let ag="firestore_clients";function ap(e,t){return`${ag}_${e}_${t}`}let am="firestore_mutations";function ay(e,t,r){let n=`${am}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let aw="firestore_targets";function av(e,t){return`${aw}_${e}_${t}`}let ab="SharedClientState";class a_{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new $(n.error.code,n.error.message)),s?new a_(e,t,n.state,i):(F(ab,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aI{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new $(r.error.code,r.error.message)),i?new aI(e,r.state,n):(F(ab,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aE{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=nS;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=eZ(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new aE(e,i):(F(ab,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aT{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aT(t.clientId,t.onlineState):(F(ab,`Failed to parse online state: ${e}`),null)}}class aS{constructor(){this.activeTargetIds=nS}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class ax{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new tY(et),this.started=!1,this.Zs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=ap(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new aS),this.eo=RegExp(`^${ag}_${l}_([^_]*)$`),this.no=RegExp(`^${am}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${aw}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(ap(this.persistenceKey,e));if(t){let r=aE.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(av(this.persistenceKey,e));if(t){let n=aI.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(av(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return P(ab,"READ",e,t),t}setItem(e,t){P(ab,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){P(ab,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(P(ab,"EVENT",e.key,e.newValue),e.key===this.Xs)return void F("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=eJ.ce;if(null!=e)try{let r=JSON.parse(e);j("number"==typeof r,30636,{yo:e}),t=r}catch(e){F(ab,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eJ.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new a_(this.currentUser,e,t,r),i=ay(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=ay(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=av(this.persistenceKey,e),i=new aI(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return aE.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return a_.$s(new R(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return aI.$s(r,t)}_o(e){return aT.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);P(ab,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=nS;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class aC{constructor(){this.vo=new aS,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new aS,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aA{Mo(e){}shutdown(){}}let ak="ConnectivityMonitor";class aD{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(P(ak,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(P(ak,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aN=null;function aR(){return null===aN?aN=0x10000000+Math.round(0x80000000*Math.random()):aN++,"0x"+aN.toString(16)}let aO="RestConnection",aM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class aL{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===rl?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=aR(),a=this.Qo(e,t.toUriEncodedString());P(aO,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=(0,x.isCloudWorkstation)(l);return this.zo(e,a,o,r,u).then(t=>(P(aO,`Received RPC '${e}' ${s}: `,t),t),t=>{throw V(aO,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+O,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=aM[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class aP{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let aF="WebChannelConnection",aV=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class aU extends aL{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){aU.c_||(aV(c(),h.STAT_EVENT,e=>{e.stat===u.PROXY?P(aF,"STAT_EVENT: detected buffering proxy"):e.stat===u.NOPROXY&&P(aF,"STAT_EVENT: detected no buffering proxy")}),aU.c_=!0)}zo(e,t,r,n,i){let a=aR();return new Promise((i,u)=>{let h=new s;h.setWithCredentials(!0),h.listenOnce(o.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case l.NO_ERROR:let t=h.getResponseJson();P(aF,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(t)),i(t);break;case l.TIMEOUT:P(aF,`RPC '${e}' ${a} timed out`),u(new $(z.DEADLINE_EXCEEDED,"Request time out"));break;case l.HTTP_ERROR:let r=h.getStatus();if(P(aF,`RPC '${e}' ${a} failed with status:`,r,"response text:",h.getResponseText()),r>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(z).indexOf(e)>=0?e:z.UNKNOWN);u(new $(r,t.message))}else u(new $(z.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new $(z.UNAVAILABLE,"Connection failed."));break;default:B(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{P(aF,`RPC '${e}' ${a} completed.`)}});let c=JSON.stringify(n);P(aF,`RPC '${e}' ${a} sending request:`,n),h.send(t,"POST",c,r,15)})}T_(e,t,r){let n=aR(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let u=i.join("");P(aF,`Creating RPC '${e}' stream ${n}: ${u}`,o);let h=s.createWebChannel(u,o);this.I_(h);let c=!1,d=!1,g=new aP({Ho:t=>{d?P(aF,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(c||(P(aF,`Opening RPC '${e}' stream ${n} transport.`),h.open(),c=!0),P(aF,`RPC '${e}' stream ${n} sending:`,t),h.send(t))},Jo:()=>h.close()});return aV(h,a.EventType.OPEN,()=>{d||(P(aF,`RPC '${e}' stream ${n} transport opened.`),g.i_())}),aV(h,a.EventType.CLOSE,()=>{d||(d=!0,P(aF,`RPC '${e}' stream ${n} transport closed`),g.o_(),this.E_(h))}),aV(h,a.EventType.ERROR,t=>{d||(d=!0,V(aF,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),g.o_(new $(z.UNAVAILABLE,"The operation could not be completed")))}),aV(h,a.EventType.MESSAGE,t=>{if(!d){let r=t.data[0];j(!!r,16349);let i=r?.error||r[0]?.error;if(i){P(aF,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=f[e];if(void 0!==t)return n3(t)}(t),s=i.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&V(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),void 0===r&&(r=z.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,g.o_(new $(r,s)),h.close()}else P(aF,`RPC '${e}' stream ${n} received:`,r),g.__(r)}}),aU.u_(),setTimeout(()=>{g.s_()},0),g}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return d()}}function aB(){return"undefined"!=typeof window?window:null}function aq(){return"undefined"!=typeof document?document:null}function aj(e){return new iy(e,!0)}aU.c_=!1;class az{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&P("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let a$="PersistentStream";class aK{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new az(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===z.RESOURCE_EXHAUSTED?(F(t.toString()),F("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===z.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new $(z.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return P(a$,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(P(a$,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aG extends aK{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:B(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(j(void 0===i||"string"==typeof i,58123),t3.fromBase64String(i||"")):(j(void 0===i||i instanceof S.Buffer||i instanceof Uint8Array,16193),t3.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new il(s,a,o,l&&new $(void 0===l.code?z.UNKNOWN:n3(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=ix(e,n.document.name),s=i_(n.document.updateTime),a=n.document.createTime?i_(n.document.createTime):e_.min(),o=new rL({mapValue:{fields:n.document.fields}}),l=rP.newFoundDocument(i,s,a,o);r=new ia(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=ix(e,n.document),s=n.readTime?i_(n.readTime):e_.min(),a=rP.newNoDocument(i,s);r=new ia([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=ix(e,n.document);r=new ia([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return B(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new n5(n,i);r=new io(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return e_.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?e_.min():t.readTime?i_(t.readTime):e_.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=ik(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=r4(n)?{documents:iL(e,n)}:{query:iP(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=ib(e,t.resumeToken);let n=iw(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(e_.min())>0){r.readTime=iv(e,t.snapshotVersion.toTimestamp());let n=iw(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=ik(this.serializer),t.removeTarget=e,this.K_(t)}}class aQ extends aK{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return j(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,j(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;j(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(j(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?i_(e.updateTime):i_(r)).isEqual(e_.min())&&(t=i_(r)),new nU(t,e.transformResults||[])})):[]),i=i_(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=ik(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iO(this.serializer,e))};this.K_(t)}}class aH{}class aW extends aH{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new $(z.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,iE(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $(z.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,iE(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $(z.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aJ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(F(t),this.aa=!1):P("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let aY="RemoteStore";class aX{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{a4(this)&&(P(aY,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await a0(e),e.Va.set("Unknown"),e.Ea.delete(4),await aZ(e)}(this))})}),this.Va=new aJ(r,n)}}async function aZ(e){if(a4(e))for(let t of e.Ra)await t(!0)}async function a0(e){for(let t of e.Ra)await t(!1)}function a1(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),a8(e)?a3(e):of(e).O_()&&a5(e,t))}function a2(e,t){let r=of(e);e.Ia.delete(t),r.O_()&&a6(e,t),0===e.Ia.size&&(r.O_()?r.L_():a4(e)&&e.Va.set("Unknown"))}function a5(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(e_.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}of(e).Z_(t)}function a6(e,t){e.da.$e(t),of(e).X_(t)}function a3(e){e.da=new ih({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),of(e).start(),e.Va.ua()}function a8(e){return a4(e)&&!of(e).x_()&&e.Ia.size>0}function a4(e){return 0===e.Ea.size}async function a9(e){e.Va.set("Online")}async function a7(e){e.Ia.forEach((t,r)=>{a5(e,t)})}async function oe(e,t){e.da=void 0,a8(e)?(e.Va.ha(t),a3(e)):e.Va.set("Unknown")}async function ot(e,t,r){if(e.Va.set("Online"),t instanceof il&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){P(aY,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await or(e,r)}else if(t instanceof ia?e.da.Xe(t):t instanceof io?e.da.st(t):e.da.tt(t),!r.isEqual(e_.min()))try{let t,n=await ai(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(t3.EMPTY_BYTE_STRING,n.snapshotVersion)),a6(e,t);let i=new ij(n.target,t,r,n.sequenceNumber);a5(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){P(aY,"Failed to raise snapshot:",t),await or(e,t)}}async function or(e,t,r){if(!ej(t))throw t;e.Ea.add(1),await a0(e),e.Va.set("Offline"),r||(r=()=>ai(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{P(aY,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await aZ(e)})}function on(e,t){return t().catch(r=>or(e,r,t))}async function oi(e){var t;let r=og(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;a4(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=og(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await or(e,t)}os(e)&&oa(e)}function os(e){return a4(e)&&!og(e).x_()&&e.Ta.length>0}function oa(e){og(e).start()}async function oo(e){og(e).ra()}async function ol(e){let t=og(e);for(let r of e.Ta)t.ea(r.mutations)}async function ou(e,t,r){let n=e.Ta.shift(),i=n0.from(n,t,r);await on(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await oi(e)}async function oh(e,t){t&&og(e).Y_&&await async function(e,t){var r;if(n6(r=t.code)&&r!==z.ABORTED){let r=e.Ta.shift();og(e).B_(),await on(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await oi(e)}}(e,t),os(e)&&oa(e)}async function oc(e,t){e.asyncQueue.verifyOperationInProgress(),P(aY,"RemoteStore received new credentials");let r=a4(e);e.Ea.add(3),await a0(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await aZ(e)}async function od(e,t){t?(e.Ea.delete(2),await aZ(e)):t||(e.Ea.add(2),await a0(e),e.Va.set("Unknown"))}function of(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:a9.bind(null,e),Yo:a7.bind(null,e),t_:oe.bind(null,e),J_:ot.bind(null,e)},t.sa(),e.ma=new aG(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),a8(e)?a3(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function og(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:oo.bind(null,e),t_:oh.bind(null,e),ta:ol.bind(null,e),na:ou.bind(null,e)},t.sa(),e.fa=new aQ(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await oi(e)):(await e.fa.stop(),e.Ta.length>0&&(P(aY,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class op{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new K,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new op(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function om(e,t){if(F("AsyncQueue",`${t}: ${e}`),ej(e))return new $(z.UNAVAILABLE,`${t}: ${e}`);throw e}class oy{static emptySet(e){return new oy(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||eh.comparator(t.key,r.key):(e,t)=>eh.comparator(e.key,t.key),this.keyedMap=nv(),this.sortedSet=new tY(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oy)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new oy;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class ow{constructor(){this.ga=new tY(eh.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):B(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ov{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ov(e,t,oy.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class ob{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class o_{constructor(){this.queries=oI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new $(z.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=oI(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function oI(){return new nm(e=>nc(e),nh)}async function oE(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new ob,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=om(r,`Initialization of query '${nd(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&oC(e)}async function oT(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function oS(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&oC(e)}function ox(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function oC(e){e.Ca.forEach(e=>{e.next()})}(m=p||(p={})).Ma="default",m.Cache="cache";class oA{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new ov(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ov.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==p.Cache}}class ok{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class oD{constructor(e){this.serializer=e}Ks(e){return ix(this.serializer,e)}qs(e){return e.metadata.exists?iR(this.serializer,e.document,!1):rP.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return i_(e)}}class oN{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=oR(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=eo.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new oD(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||nT()).add(e);t.set(r,n)}}return t}async ja(e){let t=await ad(e,new oD(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await af(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function oR(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oO{constructor(e){this.key=e}}class oM{constructor(e){this.key=e}}class oL{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=nT(),this.mutatedKeys=nT(),this.eu=np(e),this.tu=new oy(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new ow,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=nf(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new ov(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ow,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=nT(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new oM(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new oO(r))}),t}cu(e){this.Za=e.ks,this.Ya=nT();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ov.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let oP="SyncEngine";class oF{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class oV{constructor(e){this.key=e,this.hu=!1}}class oU{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new nm(e=>nc(e),nh),this.Iu=new Map,this.Eu=new Set,this.Ru=new tY(eh.comparator),this.Au=new Map,this.Vu=new sG,this.du={},this.mu=new Map,this.fu=sS.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oB(e,t,r=!0){let n,i=la(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await oj(i,t,r,!0),n}async function oq(e,t){let r=la(e);await oj(r,t,!0,!1)}async function oj(e,t,r,n){let i,s=await aa(e.localStore,na(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await oz(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&a1(e.remoteStore,s),i}async function oz(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await al(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return o2(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await al(e.localStore,t,!0),a=new oL(t,s.ks),o=a.ru(s.documents),l=is.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);o2(e,r,u.au);let h=new oF(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function o$(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!nh(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await ao(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&a2(e.remoteStore,n.targetId),o0(e,n.targetId)}).catch(eM)):(o0(e,n.targetId),await ao(e.localStore,n.targetId,!0))}async function oK(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),a2(e.remoteStore,r.targetId))}async function oG(e,t,r){let n=lo(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=eb.now(),l=t.reduce((e,t)=>e.add(t.key),nT()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=ny,s=nT();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=nk(n.transform,e||null);null!=i&&(null===r&&(r=rL.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new nQ(r.key,t,function e(t){let r=[];return tW(t.fields,(t,n)=>{let i=new eu([t]);if(rA(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new t5(r)}(t.value.mapValue),nB.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:nb(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new tY(et)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await o6(n,h.changes),await oi(n.remoteStore)}catch(t){let e=om(t,"Failed to persist write");r.reject(e)}}async function oQ(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(t3.EMPTY_BYTE_STRING,e_.min()).withLastLimboFreeSnapshotVersion(e_.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=ny,l=nT();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(as(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(e_.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return eL.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(j(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?j(n.hu,14607):t.removedDocuments.size>0&&(j(n.hu,42227),n.hu=!1))}),await o6(e,s,t)}catch(e){await eM(e)}}function oH(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&oC(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oW(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new tY(eh.comparator);r=r.insert(i,rP.newNoDocument(i,e_.min()));let n=nT().add(i),s=new ii(e_.min(),new Map,new tY(et),r,n);await oQ(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),o5(e)}else await ao(e.localStore,t,!1).then(()=>o0(e,t,r)).catch(eM)}async function oJ(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=eL.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);j(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=nT();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));oZ(e,n,null),oX(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await o6(e,i)}catch(e){await eM(e)}}async function oY(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(j(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));oZ(e,t,r),oX(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await o6(e,i)}catch(e){await eM(e)}}function oX(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function oZ(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function o0(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||o1(e,t)})}function o1(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(a2(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),o5(e))}function o2(e,t,r){for(let n of r)n instanceof oO?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(P(oP,"New document in limbo: "+r),e.Eu.add(n),o5(e))}(e,n)):n instanceof oM?(P(oP,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||o1(e,n.key)):B(19791,{wu:n})}function o5(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new eh(eo.fromString(t)),n=e.fu.next();e.Au.set(n,new oV(r)),e.Ru=e.Ru.insert(r,n),a1(e.remoteStore,new ij(na(nr(r.path)),n,"TargetPurposeLimboResolution",eJ.ce))}}async function o6(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=s9.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>eL.forEach(t,t=>eL.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>eL.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!ej(e))throw e;P(at,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function o3(e,t){if(!e.currentUser.isEqual(t)){P(oP,"User change. New user:",t.toKey());let r=await an(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new $(z.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await o6(e,r.Ns)}}function o8(e,t){let r=e.Au.get(t);if(r&&r.hu)return nT().add(r.key);{let r=nT(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function o4(e,t){let r=await al(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&o2(e,t.targetId,n.au),n}async function o9(e,t){return ah(e.localStore,t).then(t=>o6(e,t))}async function o7(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eL.resolve(null))));null!==o?("pending"===r?await oi(e.remoteStore):"acknowledged"===r||"rejected"===r?(oZ(e,t,n||null),oX(e,t),s=e.localStore,s.mutationQueue.nr(t)):B(6720,"Unknown batchState",{bu:r}),await o6(e,o)):P(oP,"Cannot apply mutation batch with id: "+t)}async function le(e,t){if(la(e),lo(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await lt(e,t.toArray());for(let t of(e.gu=!0,await od(e.remoteStore,!0),r))a1(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(o0(e,i),ao(e.localStore,i,!0))),a2(e.remoteStore,i)}),await r,await lt(e,t),e.Au.forEach((t,r)=>{a2(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new tY(eh.comparator),e.gu=!1,await od(e.remoteStore,!1)}}async function lt(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await aa(e.localStore,na(s[0])),s)){let t=e.Tu.get(r),n=await o4(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await au(e.localStore,r);t=await aa(e.localStore,n),await oz(e,lr(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function lr(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new nt(t,r,n,i,s,"F",e.startAt,e.endAt)}function ln(e){return e.localStore.persistence.hs()}async function li(e,t,r,n){if(e.gu)return void P(oP,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await ah(e.localStore,ng(i[0])),s=ii.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,t3.EMPTY_BYTE_STRING);await o6(e,n,s);break}case"rejected":await ao(e.localStore,t,!0),o0(e,t,n);break;default:B(64155,r)}}async function ls(e,t,r){let n=la(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){P(oP,"Adding an already active target "+e);continue}let t=await au(n.localStore,e),r=await aa(n.localStore,t);await oz(n,lr(t),r.targetId,!1,r.resumeToken),a1(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await ao(n.localStore,e,!1).then(()=>{a2(n.remoteStore,e),o0(n,e)}).catch(eM)}}function la(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=oQ.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=o8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oW.bind(null,e),e.Pu.J_=oS.bind(null,e.eventManager),e.Pu.yu=ox.bind(null,e.eventManager),e}function lo(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oJ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oY.bind(null,e),e}class ll{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aj(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new ae,new ar(t,r,e.initialUser,this.serializer)}Cu(e){return new sX(s0.Vi,this.serializer)}Du(e){return new aC}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ll.provider={build:()=>new ll};class lu extends ll{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return j(this.persistence.referenceDelegate instanceof s1,46915),new sN(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?sv.withCacheSize(this.cacheSizeBytes):sv.DEFAULT;return new sX(e=>s1.Vi(e,t),this.serializer)}}class lh extends ll{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await lo(this.xu.syncEngine),await oi(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new ae,new ar(t,r,e.initialUser,this.serializer)}Fu(e,t){return new sN(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new eW(t,this.persistence);return new eH(e.asyncQueue,r)}Cu(e){let t=s4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?sv.withCacheSize(this.cacheSizeBytes):sv.DEFAULT;return new s8(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,aB(),aq(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new aC}}class lc extends lh{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof ax&&(this.sharedClientState.syncEngine={So:o7.bind(null,t),Do:li.bind(null,t),Co:ls.bind(null,t),hs:ln.bind(null,t),bo:o9.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await le(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=aB();if(!ax.v(t))throw new $(z.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=s4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ax(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ld{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oH(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=o3.bind(null,this.syncEngine),await od(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new o_}createDatastore(e){var t;let r=aj(e.databaseInfo.databaseId),n=new aU(e.databaseInfo);return t=e.authCredentials,new aW(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new aX(t,r,e.asyncQueue,e=>oH(this.syncEngine,e,0),aD.v()?new aD:new aA)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new oU(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){P(aY,"RemoteStore shutting down."),e.Ea.add(5),await a0(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function lf(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}ld.provider={build:()=>new ld};class lg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):F("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class lp{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new K,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new ok(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lm{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new ok(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new $(z.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class ly{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new $(z.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>iS(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,eo.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(j(!!t.found,43571),t.found.name,t.found.updateTime,n=ix(r,t.found.name),s=i_(t.found.updateTime),a=t.found.createTime?i_(t.found.createTime):e_.min(),o=new rL({mapValue:{fields:t.found.fields}}),rP.newFoundDocument(n,s,a,o)):"missing"in t?(j(!!t.missing,3894),j(!!t.readTime,22933),l=ix(r,t.missing),u=i_(t.readTime),rP.newNoDocument(l,u)):B(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());j(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new nY(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=eh.fromPath(t);this.mutations.push(new nX(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>iO(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,eo.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B(50498,{Gu:e.constructor.name});t=e_.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new $(z.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(e_.min())?nB.exists(!1):nB.updateTime(t):nB.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(e_.min()))throw new $(z.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nB.updateTime(t)}return nB.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lw{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new az(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new ly(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!eY(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!n6(t)}return!1}}let lv="FirestoreClient";class lb{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=R.UNAUTHENTICATED,this.clientId=ee.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{P(lv,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(P(lv,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new K;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=om(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function l_(e,t){e.asyncQueue.verifyOperationInProgress(),P(lv,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await an(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lI(e,t){e.asyncQueue.verifyOperationInProgress();let r=await lE(e);P(lv,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>oc(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>oc(t.remoteStore,r)),e._onlineComponents=t}async function lE(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){P(lv,"Using user provided OfflineComponentProvider");try{await l_(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===z.FAILED_PRECONDITION||t.code===z.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;V("Error using user provided cache. Falling back to memory cache: "+t),await l_(e,new ll)}}else P(lv,"Using default OfflineComponentProvider"),await l_(e,new lu(void 0));return e._offlineComponents}async function lT(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(P(lv,"Using user provided OnlineComponentProvider"),await lI(e,e._uninitializedComponentsProvider._online)):(P(lv,"Using default OnlineComponentProvider"),await lI(e,new ld))),e._onlineComponents}function lS(e){return lE(e).then(e=>e.localStore)}function lx(e){return lT(e).then(e=>e.syncEngine)}function lC(e){return lT(e).then(e=>e.datastore)}async function lA(e){let t=await lT(e),r=t.eventManager;return r.onListen=oB.bind(null,t.syncEngine),r.onUnlisten=o$.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=oq.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=oK.bind(null,t.syncEngine),r}function lk(e,t,r={}){let n=new K;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lA(e),s=e.asyncQueue,a=new lg({next:e=>{a.Nu(),s.enqueueAndForget(()=>oT(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new $(z.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new $(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),oE(i,o=new oA(nr(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function lD(e,t,r={}){let n=new K;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lA(e),s=e.asyncQueue,o=new oA(t,a=new lg({next:e=>{a.Nu(),s.enqueueAndForget(()=>oT(i,o)),e.fromCache&&"server"===r.source?n.reject(new $(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),oE(i,o)}),n.promise}function lN(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lR=new Map,lO="firestore.googleapis.com";class lM{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new $(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lO,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new $(z.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lN(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new $(z.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new $(z.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new $(z.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lL{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lM({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lM(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Q;switch(e.type){case"firstParty":return new Y(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new $(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lR.get(this))&&(P("ComponentProvider","Removing Datastore"),lR.delete(this),e.terminate()),Promise.resolve()}}class lP{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new lP(this.firestore,e,this._query)}}class lF{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lV(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lF(this.firestore,e,this._key)}toJSON(){return{type:lF._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ev(t,lF._jsonSchema))return new lF(e,r||null,new eh(eo.fromString(t.referencePath)))}}lF._jsonSchemaVersion="firestore/documentReference/1.0",lF._jsonSchema={type:ew("string",lF._jsonSchemaVersion),referencePath:ew("string")};class lV extends lP{constructor(e,t,r){super(e,t,nr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lF(this.firestore,null,new eh(e))}withConverter(e){return new lV(this.firestore,e,this._path)}}function lU(e,t,...r){if(e=(0,x.getModularInstance)(e),ec("collection","path",t),e instanceof lL){let n=eo.fromString(t,...r);return ef(n),new lV(e,null,n)}{if(!(e instanceof lF||e instanceof lV))throw new $(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(eo.fromString(t,...r));return ef(n),new lV(e.firestore,null,n)}}function lB(e,t,...r){if(e=(0,x.getModularInstance)(e),1==arguments.length&&(t=ee.newId()),ec("doc","path",t),e instanceof lL){let n=eo.fromString(t,...r);return ed(n),new lF(e,null,new eh(n))}{if(!(e instanceof lF||e instanceof lV))throw new $(z.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(eo.fromString(t,...r));return ed(n),new lF(e.firestore,e instanceof lV?e.converter:null,new eh(n))}}function lq(e,t){return e=(0,x.getModularInstance)(e),t=(0,x.getModularInstance)(t),e instanceof lP&&t instanceof lP&&e.firestore===t.firestore&&nh(e._query,t._query)&&e.converter===t.converter}let lj="AsyncQueue";class lz{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new az(this,"async_queue_retry"),this._c=()=>{let e=aq();e&&P(lj,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=aq();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=aq();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new K;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!ej(e))throw e;P(lj,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,F("INTERNAL UNHANDLED ERROR: ",l$(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=op.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&B(47125,{Pc:l$(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function l$(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class lK{constructor(){this._progressObserver={},this._taskCompletionResolver=new K,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class lG extends lL{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new lz,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lz(e),this._firestoreClient=void 0,await e}}}function lQ(e,t){let r="object"==typeof e?e:(0,v.getApp)(),n=(0,v._getProvider)(r,"firestore").getImmediate({identifier:"string"==typeof e?e:t||rl});if(!n._initialized){let e=(0,x.getDefaultEmulatorHostnameAndPort)("firestore");e&&function(e,t,r,n={}){e=em(e,lL);let i=(0,x.isCloudWorkstation)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&((0,x.pingServer)(`https://${o}`),(0,x.updateEmulatorBanner)("Firestore",!0)),s.host!==lO&&s.host!==o&&V("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!(0,x.deepEqual)(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=R.MOCK_USER;else{t=(0,x.createMockUserToken)(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new $(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new R(i)}e._authCredentials=new H(new G(t,r))}}(n,...e)}return n}function lH(e){if(e._terminated)throw new $(z.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new ro(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,lN(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new lb(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function lW(e,t){let r=lH(e=em(e,lG)),n=new lK;return function(e,t,r,n){var i;let s=(i=aj(t),new lp(function(e,t){if(e instanceof Uint8Array)return lf(e,void 0);if(e instanceof ArrayBuffer)return lf(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?n4().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=i_(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(oR(a));let o=new oN(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await o6(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return V(oP,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await lx(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class lJ{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lJ(t3.fromBase64String(e))}catch(e){throw new $(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lJ(t3.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lJ._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ev(e,lJ._jsonSchema))return lJ.fromBase64String(e.bytes)}}lJ._jsonSchemaVersion="firestore/bytes/1.0",lJ._jsonSchema={type:ew("string",lJ._jsonSchemaVersion),bytes:ew("string")};class lY{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lX{constructor(e){this._methodName=e}}class lZ{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return et(this._lat,e._lat)||et(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:lZ._jsonSchemaVersion}}static fromJSON(e){if(ev(e,lZ._jsonSchema))return new lZ(e.latitude,e.longitude)}}lZ._jsonSchemaVersion="firestore/geoPoint/1.0",lZ._jsonSchema={type:ew("string",lZ._jsonSchemaVersion),latitude:ew("number"),longitude:ew("number")};class l0{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:l0._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ev(e,l0._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new l0(e.vectorValues);throw new $(z.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}l0._jsonSchemaVersion="firestore/vectorValue/1.0",l0._jsonSchema={type:ew("string",l0._jsonSchemaVersion),vectorValues:ew("object")};let l1=/^__.*__$/;class l2{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new nQ(e,this.data,this.fieldMask,t,this.fieldTransforms):new nG(e,this.data,t,this.fieldTransforms)}}class l5{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new nQ(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function l6(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{dataSource:e})}}class l3{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new l3({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return uh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(l6(this.dataSource)&&l1.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class l8{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||aj(e)}createContext(e,t,r,n=!1){return new l3({dataSource:e,methodName:t,targetDoc:r,path:eu.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function l4(e){let t=e._freezeSettings(),r=aj(e._databaseId);return new l8(e._databaseId,!!t.ignoreUndefinedProperties,r)}function l9(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);ua("Data must be an object, but it was:",l,n);let u=ui(n,l);if(s.merge)a=new t5(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=uo(t,n,r);if(!l.contains(i))throw new $(z.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uc(e,i)||e.push(i)}a=new t5(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new l2(new rL(u),a,o)}class l7 extends lX{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof l7}}function ue(e,t,r,n){let i=e.createContext(1,t,r);ua("Data must be an object, but it was:",i,n);let s=[],a=rL.empty();return tW(n,(e,n)=>{let o=uu(t,e,r);n=(0,x.getModularInstance)(n);let l=i.childContextForFieldPath(o);if(n instanceof l7)s.push(o);else{let e=un(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new l5(a,new t5(s),i.fieldTransforms)}function ut(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[uo(t,n,r)],l=[i];if(s.length%2!=0)throw new $(z.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(uo(t,s[e])),l.push(s[e+1]);let u=[],h=rL.empty();for(let e=o.length-1;e>=0;--e)if(!uc(u,o[e])){let t=o[e],r=l[e];r=(0,x.getModularInstance)(r);let n=a.childContextForFieldPath(t);if(r instanceof l7)u.push(t);else{let e=un(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new l5(h,new t5(u),a.fieldTransforms)}function ur(e,t,r,n=!1){return un(r,e.createContext(n?4:3,t))}function un(e,t){if(us(e=(0,x.getModularInstance)(e)))return ua("Unsupported field value:",t,e),ui(e,t);if(e instanceof lX)return function(e,t){if(!l6(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=un(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=(0,x.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,eZ(n=e)?nC(n):nx(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=eb.fromDate(e);return{timestampValue:iv(t.serializer,r)}}if(e instanceof eb){let r=new eb(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iv(t.serializer,r)}}if(e instanceof lZ)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lJ)return{bytesValue:ib(t.serializer,e._byteString)};if(e instanceof lF){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:iI(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof l0)return{mapValue:{fields:{[rh]:{stringValue:rf},[rg]:{arrayValue:{values:((i=e)instanceof l0?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return nx(t.serializer,e)})}}}}};if(iq(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${ep(e)}`)}(e,t)}function ui(e,t){let r={};return tJ(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tW(e,(e,n)=>{let i=un(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function us(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof eb||e instanceof lZ||e instanceof lJ||e instanceof lF||e instanceof lX||e instanceof l0||iq(e))}function ua(e,t,r){if(!us(r)||!eg(r)){let n=ep(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function uo(e,t,r){if((t=(0,x.getModularInstance)(t))instanceof lY)return t._internalPath;if("string"==typeof t)return uu(e,t);throw uh("Field path arguments must be of type string or ",e,!1,void 0,r)}let ul=RegExp("[~\\*/\\[\\]]");function uu(e,t,r){if(t.search(ul)>=0)throw uh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new lY(...t.split("."))._internalPath}catch(n){throw uh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function uh(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new $(z.INVALID_ARGUMENT,o+e+l)}function uc(e,t){return e.some(e=>e.isEqual(t))}class ud{convertValue(e,t="none"){switch(rm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return t9(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(t7(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return tW(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new l0(e.fields?.[rg].arrayValue?.values?.map(e=>t9(e.doubleValue)))}convertGeoPoint(e){return new lZ(t9(e.latitude),t9(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rs(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ra(e));default:return null}}convertTimestamp(e){let t=t4(e);return new eb(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=eo.fromString(e);j(iB(r),9688,{name:e});let n=new ru(r.get(1),r.get(3)),i=new eh(r.popFirst(5));return n.isEqual(t)||F(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class uf extends ud{constructor(e){super(),this.firestore=e}convertBytes(e){return new lJ(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lF(this.firestore,null,t)}}let ug="@firebase/firestore",up="4.11.0";function um(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uy{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uw{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new rL({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class uv{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lF(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new ub(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(uo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ub extends uv{data(){return super.data()}}function u_(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new $(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uI{}class uE extends uI{}function uT(e,t,...r){let n=[];for(let i of(t instanceof uI&&n.push(t),function(e){let t=e.filter(e=>e instanceof uC).length,r=e.filter(e=>e instanceof uS).length;if(t>1||t>0&&r>0)throw new $(z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class uS extends uE{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new uS(e,t,r)}_apply(e){let t=this._parse(e);return u$(e._query,t),new lP(e.firestore,e.converter,nl(e._query,t))}_parse(e){let t=l4(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new $(z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uz(a,s);let t=[];for(let r of a)t.push(uj(n,e,r));o={arrayValue:{values:t}}}else o=uj(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uz(a,s),o=ur(r,t,a,"in"===s||"not-in"===s);return rj.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ux(e,t,r){let n=uo("where",e);return uS._create(n,t,r)}class uC extends uI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uC(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rz.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())u$(r,e),r=nl(r,e)}(e._query,t),new lP(e.firestore,e.converter,nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function uA(...e){return e.forEach(e=>uK("or",e)),uC._create("or",e)}function uk(...e){return e.forEach(e=>uK("and",e)),uC._create("and",e)}class uD extends uE{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uD(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new $(z.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new $(z.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rB(t,r)}(e._query,this._field,this._direction);return new lP(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new nt(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function uN(e,t="asc"){let r=uo("orderBy",e);return uD._create(r,t)}class uR extends uE{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new uR(e,t,r)}_apply(e){return new lP(e.firestore,e.converter,nu(e._query,this._limit,this._limitType))}}function uO(e){return ey("limit",e),uR._create("limit",e,"F")}function uM(e){return ey("limitToLast",e),uR._create("limitToLast",e,"L")}class uL extends uE{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uL(e,t,r)}_apply(e){var t;let r=uq(e,this.type,this._docOrFields,this._inclusive);return new lP(e.firestore,e.converter,(t=e._query,new nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function uP(...e){return uL._create("startAt",e,!0)}function uF(...e){return uL._create("startAfter",e,!1)}class uV extends uE{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uV(e,t,r)}_apply(e){var t;let r=uq(e,this.type,this._docOrFields,this._inclusive);return new lP(e.firestore,e.converter,(t=e._query,new nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function uU(...e){return uV._create("endBefore",e,!1)}function uB(...e){return uV._create("endAt",e,!0)}function uq(e,t,r,n){if(r[0]=(0,_.getModularInstance)(r[0]),r[0]instanceof uv)return function(e,t,r,n,i){if(!n)throw new $(z.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of ns(e))if(r.field.isKeyField())s.push(rE(t,n.key));else{let e=n.data.field(r.field);if(ri(e))throw new $(z.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new $(z.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new rF(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=l4(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new $(z.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new $(z.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!ni(e)&&-1!==l.indexOf("/"))throw new $(z.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(eo.fromString(l));if(!eh.isDocumentKey(r))throw new $(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new eh(r);o.push(rE(t,i))}else{let e=ur(r,n,l);o.push(e)}}return new rF(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function uj(e,t,r){if("string"==typeof(r=(0,_.getModularInstance)(r))){if(""===r)throw new $(z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ni(t)&&-1!==r.indexOf("/"))throw new $(z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(eo.fromString(r));if(!eh.isDocumentKey(n))throw new $(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rE(e,new eh(n))}if(r instanceof lF)return rE(e,r._key);throw new $(z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ep(r)}.`)}function uz(e,t){if(!Array.isArray(e)||0===e.length)throw new $(z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function u$(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new $(z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new $(z.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function uK(e,t){if(!(t instanceof uS||t instanceof uC))throw new $(z.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function uG(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class uQ extends ud{constructor(e){super(),this.firestore=e}convertBytes(e){return new lJ(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lF(this.firestore,null,t)}}function uH(e){return new uy("sum",uo("sum",e))}function uW(e){return new uy("avg",uo("average",e))}function uJ(){return new uy("count")}function uY(e,t){return e instanceof uy&&t instanceof uy&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function uX(e,t){return lq(e.query,t.query)&&(0,_.deepEqual)(e.data(),t.data())}function uZ(e){return u0(e,{count:uJ()})}function u0(e,t){var r;let n,i=em(e.firestore,lG),s=lH(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new n2(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new K,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await lC(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=iP(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:iV(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:iV(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=no(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);j(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new uw(e,new uf(i),t))}class u1{constructor(e){this.kind="memory",this._onlineComponentProvider=ld.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new lu(void 0)}}toJSON(){return{kind:this.kind}}}class u2{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=ht(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class u5{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ll.provider}toJSON(){return{kind:this.kind}}}class u6{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new lu(e)}}toJSON(){return{kind:this.kind}}}function u3(){return new u5}function u8(e){return new u6(e?.cacheSizeBytes)}function u4(e){return new u1(e)}function u9(e){return new u2(e)}class u7{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ld.provider,this._offlineComponentProvider={build:t=>new lh(t,e?.cacheSizeBytes,this.forceOwnership)}}}class he{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ld.provider,this._offlineComponentProvider={build:t=>new lc(t,e?.cacheSizeBytes)}}}function ht(e){return new u7(e?.forceOwnership)}function hr(){return new he}let hn="NOT SUPPORTED";class hi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hs extends uv{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ho(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(uo("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new $(z.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=hs._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function ha(e,t,r){if(ev(t,hs._jsonSchema)){var n;if(t.bundle===hn)throw new $(z.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aj(e._databaseId),s=(n=t.bundle,new lm(n,i)),a=s.t(),o=new oN(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new $(z.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=iR(i,l[0].document),h=new eh(eo.fromString(t.bundleName));return new hs(e,new uQ(e),h,u,new hi(!1,!1),r||null)}}hs._jsonSchemaVersion="firestore/documentSnapshot/1.0",hs._jsonSchema={type:ew("string",hs._jsonSchemaVersion),bundleSource:ew("string","DocumentSnapshot"),bundleName:ew("string"),bundle:ew("string")};class ho extends hs{data(e={}){return super.data(e)}}class hl{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new hi(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ho(this._firestore,this._userDataWriter,r.key,r,new hi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new ho(e._firestore,e._userDataWriter,r.doc.key,r.doc,new hi(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new ho(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hi(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new $(z.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=hl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ee.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function hu(e,t,r){if(ev(t,hl._jsonSchema)){var n;if(t.bundle===hn)throw new $(z.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aj(e._databaseId),s=(n=t.bundle,new lm(n,i)),a=s.t(),o=new oN(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new $(z.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=iY(o.queries[0].bundledQuery),u=o.documents,h=new oy;u.map(e=>{let t=iR(i,e.document);h=h.add(t)});let c=ov.fromInitialDocuments(l,h,nT(),!1,!1),d=new lP(e,r||null,l);return new hl(e,new uQ(e),d,c)}}function hh(e,t){return e instanceof hs&&t instanceof hs?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hl&&t instanceof hl&&e._firestore===t._firestore&&lq(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}hl._jsonSchemaVersion="firestore/querySnapshot/1.0",hl._jsonSchema={type:ew("string",hl._jsonSchemaVersion),bundleSource:ew("string","QuerySnapshot"),bundleName:ew("string"),bundle:ew("string")};let hc={maxAttempts:5};class hd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=l4(e)}set(e,t,r){this._verifyNotCommitted();let n=hf(e,this._firestore),i=uG(n.converter,t,r),s=l9(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,nB.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=hf(e,this._firestore);return i="string"==typeof(t=(0,_.getModularInstance)(t))||t instanceof lY?ut(this._dataReader,"WriteBatch.update",s._key,t,r,n):ue(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,nB.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hf(e,this._firestore);return this._mutations=this._mutations.concat(new nY(t._key,nB.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $(z.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hf(e,t){if((e=(0,_.getModularInstance)(e)).firestore!==t)throw new $(z.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hg{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=l4(e)}get(e){let t=hf(e,this._firestore),r=new uQ(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return B(24041);let n=e[0];if(n.isFoundDocument())return new uv(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new uv(this._firestore,r,t._key,null,t.converter);throw B(18433,{doc:n})})}set(e,t,r){let n=hf(e,this._firestore),i=uG(n.converter,t,r),s=l9(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=hf(e,this._firestore);return i="string"==typeof(t=(0,_.getModularInstance)(t))||t instanceof lY?ut(this._dataReader,"Transaction.update",s._key,t,r,n):ue(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=hf(e,this._firestore);return this._transaction.delete(t._key),this}}class hp extends hg{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hf(e,this._firestore),r=new uf(this._firestore);return super.get(e).then(e=>new hs(this._firestore,r,t._key,e._document,new hi(!1,!1),t.converter))}}function hm(e,t,r){var n,i;let s;e=em(e,lG);let a={...hc,...r};if(a.maxAttempts<1)throw new $(z.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=lH(e),i=r=>t(new hp(e,r)),s=new K,n.asyncQueue.enqueueAndForget(async()=>{let e=await lC(n);new lw(n.asyncQueue,e,a,i,s).ju()}),s.promise}function hy(e){e=em(e,lF);let t=em(e.firestore,lG);return lk(lH(t),e._key).then(r=>hN(t,e,r))}function hw(e){var t;let r;e=em(e,lF);let n=em(e.firestore,lG),i=lH(n),s=new uf(n);return(t=e._key,r=new K,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new $(z.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=om(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await lS(i),t,r)),r.promise).then(t=>new hs(n,s,e._key,t,new hi(null!==t&&t.hasLocalMutations,!0),e.converter))}function hv(e){e=em(e,lF);let t=em(e.firestore,lG);return lk(lH(t),e._key,{source:"server"}).then(r=>hN(t,e,r))}function hb(e){e=em(e,lP);let t=em(e.firestore,lG),r=lH(t),n=new uf(t);return u_(e._query),lD(r,e._query).then(r=>new hl(t,n,e,r))}function h_(e){var t;let r;e=em(e,lP);let n=em(e.firestore,lG),i=lH(n),s=new uf(n);return(t=e._query,r=new K,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await al(e,t,!0),i=new oL(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=om(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await lS(i),t,r)),r.promise).then(t=>new hl(n,s,e,t))}function hI(e){e=em(e,lP);let t=em(e.firestore,lG),r=lH(t),n=new uf(t);return lD(r,e._query,{source:"server"}).then(r=>new hl(t,n,e,r))}function hE(e,t,r){e=em(e,lF);let n=em(e.firestore,lG),i=uG(e.converter,t,r),s=l4(n);return hD(n,[l9(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,nB.none())])}function hT(e,t,r,...n){e=em(e,lF);let i=em(e.firestore,lG),s=l4(i);return hD(i,[("string"==typeof(t=(0,_.getModularInstance)(t))||t instanceof lY?ut(s,"updateDoc",e._key,t,r,n):ue(s,"updateDoc",e._key,t)).toMutation(e._key,nB.exists(!0))])}function hS(e){return hD(em(e.firestore,lG),[new nY(e._key,nB.none())])}function hx(e,t){let r=em(e.firestore,lG),n=lB(e),i=uG(e.converter,t);return hD(r,[l9(l4(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,nB.exists(!1))]).then(()=>n)}function hC(e,...t){var r;let n,i,s,a,o;e=(0,_.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||um(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(um(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof lF)i=em(e.firestore,lG),s=nr(e._key.path),n={next:r=>{t[u]&&t[u](hN(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=em(e,lP);i=em(r.firestore,lG),s=r._query;let a=new uf(i);n={next:e=>{t[u]&&t[u](new hl(i,a,r,e))},error:t[u+1],complete:t[u+2]},u_(e._query)}return r=lH(i),o=new oA(s,a=new lg(n),h),r.asyncQueue.enqueueAndForget(async()=>oE(await lA(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>oT(await lA(r),o))}}function hA(e,t,...r){var n,i,s,a,o,l;let u=(0,_.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new $(z.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||um(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&um(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,lW(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=lH(e=em(e,lG)),r.asyncQueue.enqueue(async()=>{var e;return e=await lS(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new lP(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=hC(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&um(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,lW(u,h.bundle).then(()=>{t||(e=hC(new lF(u,l||null,eh.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new $(z.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function hk(e,t){let r,n=lH(e=em(e,lG));return r=new lg(um(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lA(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lA(n),void e.Ca.delete(r)})}}function hD(e,t){var r;let n;return r=lH(e),n=new K,r.asyncQueue.enqueueAndForget(async()=>oG(await lx(r),t,n)),n.promise}function hN(e,t,r){let n=r.docs.get(t._key),i=new uf(e);return new hs(e,i,t._key,n,new hi(r.hasPendingWrites,r.fromCache),t.converter)}function hR(e){return lH(e=em(e,lG)),new hd(e,t=>hD(e,t))}function hO(e,t){let r=lH(e=em(e,lG));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return V("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new $(z.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=hM(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=uu("setIndexConfiguration",hM(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new ex(e,2)):"ASCENDING"===t.order?n.push(new ex(e,0)):"DESCENDING"===t.order&&n.push(new ex(e,1))}r.push(new eI(eI.UNKNOWN_ID,t,n,eC.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,eS,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>eL.waitFor(n)))})(await lS(r),n))}function hM(e,t){if("string"!=typeof e[t])throw new $(z.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class hL{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function hP(e){e=em(e,lG);let t=hq.get(e);if(t)return t;let r=lH(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new hL(e);return hq.set(e,n),n}function hF(e){hB(e,!0)}function hV(e){hB(e,!1)}function hU(e){var t;(t=lH(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await lS(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>P("deleting all persistent cache indexes succeeded")).catch(e=>V("deleting all persistent cache indexes failed",e))}function hB(e,t){var r;(r=lH(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await lS(r),void(e.Cs.As=t)})).then(e=>P(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>V(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let hq=new WeakMap;class hj{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return hz.instance.onExistenceFilterMismatch(e)}}class hz{constructor(){this.i=new Map}static get instance(){return h$||function(e){if(n8)throw Error("a TestingHooksSpi instance is already set");n8=e}(h$=new hz),h$}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let h$=null;!function(e=!0){O=v.SDK_VERSION,(0,v._registerComponent)(new E.Component("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new lG(new W(t.getProvider("auth-internal")),new Z(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new $(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ru(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,v.registerVersion)(ug,up,void 0),(0,v.registerVersion)(ug,up,"esm2020")}(),e.s(["AggregateField",()=>uy,"AggregateQuerySnapshot",()=>uw,"DocumentSnapshot",()=>hs,"PersistentCacheIndexManager",()=>hL,"QueryCompositeFilterConstraint",()=>uC,"QueryConstraint",()=>uE,"QueryDocumentSnapshot",()=>ho,"QueryEndAtConstraint",()=>uV,"QueryFieldFilterConstraint",()=>uS,"QueryLimitConstraint",()=>uR,"QueryOrderByConstraint",()=>uD,"QuerySnapshot",()=>hl,"QueryStartAtConstraint",()=>uL,"SnapshotMetadata",()=>hi,"Transaction",()=>hp,"WriteBatch",()=>hd,"_TestingHooks",()=>hj,"addDoc",()=>hx,"aggregateFieldEqual",()=>uY,"aggregateQuerySnapshotEqual",()=>uX,"and",()=>uk,"average",()=>uW,"count",()=>uJ,"deleteAllPersistentCacheIndexes",()=>hU,"deleteDoc",()=>hS,"disablePersistentCacheIndexAutoCreation",()=>hV,"documentSnapshotFromJSON",()=>ha,"enablePersistentCacheIndexAutoCreation",()=>hF,"endAt",()=>uB,"endBefore",()=>uU,"executeWrite",()=>hD,"getAggregateFromServer",()=>u0,"getCountFromServer",()=>uZ,"getDoc",()=>hy,"getDocFromCache",()=>hw,"getDocFromServer",()=>hv,"getDocs",()=>hb,"getDocsFromCache",()=>h_,"getDocsFromServer",()=>hI,"getPersistentCacheIndexManager",()=>hP,"limit",()=>uO,"limitToLast",()=>uM,"memoryEagerGarbageCollector",()=>u3,"memoryLocalCache",()=>u4,"memoryLruGarbageCollector",()=>u8,"onSnapshot",()=>hC,"onSnapshotResume",()=>hA,"onSnapshotsInSync",()=>hk,"or",()=>uA,"orderBy",()=>uN,"persistentLocalCache",()=>u9,"persistentMultipleTabManager",()=>hr,"persistentSingleTabManager",()=>ht,"query",()=>uT,"querySnapshotFromJSON",()=>hu,"runTransaction",()=>hm,"setDoc",()=>hE,"setIndexConfiguration",()=>hO,"snapshotEqual",()=>hh,"startAfter",()=>uF,"startAt",()=>uP,"sum",()=>uH,"updateDoc",()=>hT,"where",()=>ux,"writeBatch",()=>hR],14894),e.s([],19678),e.i(14894),e.s(["addDoc",()=>hx,"collection",()=>lU,"deleteDoc",()=>hS,"doc",()=>lB,"getDoc",()=>hy,"getDocs",()=>hb,"getFirestore",()=>lQ,"orderBy",()=>uN,"query",()=>uT,"setDoc",()=>hE,"updateDoc",()=>hT,"where",()=>ux],46805);var hK=_;let hG="firebasestorage.googleapis.com";class hQ extends hK.FirebaseError{constructor(e,t,r=0){super(hH(e),`Firebase Storage: ${t} (${hH(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,hQ.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return hH(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function hH(e){return"storage/"+e}function hW(e){return new hQ(y.INVALID_ARGUMENT,e)}function hJ(){return new hQ(y.APP_DELETED,"The Firebase app was deleted.")}(t=y||(y={})).UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class hY{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=hY.makeFromUrl(e,t)}catch(t){return new hY(e,"")}if(""===r.path)return r;throw new hQ(y.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),o=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),l=t===hG?"(?:storage.googleapis.com|storage.cloud.google.com)":t,u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){let n=u[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new hY(e,t),n.postModify(r);break}}if(null==r)throw new hQ(y.INVALID_URL,"Invalid URL '"+e+"'.");return r}}class hX{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function hZ(e,t,r,n){if(n<t)throw hW(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw hW(`Invalid value for '${e}'. Expected ${r} or less.`)}(r=w||(w={}))[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT";class h0{constructor(e,t,r,n,i,s,a,o,l,u,h,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new h1(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,a;null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let o=r.getErrorCode()===w.NO_ERROR,l=r.getStatus();!o||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),a=-1!==t.indexOf(l),(i||s||a)&&this.retry)?e(!1,new h1(!1,null,r.getErrorCode()===w.ABORT)):e(!0,new h1(-1!==this.successCodes_.indexOf(l),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(e){n(e)}else if(null!==i){let e=new hQ(y.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?hJ():new hQ(y.CANCELED,"User canceled the upload/download."):new hQ(y.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new h1(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(d,2===o)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let r;if(l)return void c();if(e||2===o||a){c(),u.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,h(r)}let f=!1;function g(e){f||(f=!0,c(),!l&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,g(!0)},r),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class h1{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}class h2{constructor(e,t){this._service=e,t instanceof hY?this._location=t:this._location=hY.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new h2(e,t)}get root(){let e=new hY(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){var e;let t;return -1===(t=(e=this._location.path).lastIndexOf("/",e.length-2))?e:e.slice(t+1)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new hY(this._location.bucket,e);return new h2(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new hQ(y.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function h5(e,t){let r=t?.storageBucket;return null==r?null:hY.makeFromBucketSpec(r,e)}class h6{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=hG,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=n?this._bucket=hY.makeFromBucketSpec(n,this._host):this._bucket=h5(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=hY.makeFromBucketSpec(this._url,e):this._bucket=h5(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){hZ("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){hZ("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,v._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new h2(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new hX(hJ());{let s=function(e,t,r,n,i,s,a=!0,o=!1){let l=function(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}(e.urlParams),u=e.url+l,h=Object.assign({},e.headers);return t&&(h["X-Firebase-GMPID"]=t),null!==r&&r.length>0&&(h.Authorization="Firebase "+r),h["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==n&&(h["X-Firebase-AppCheck"]=n),new h0(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let h3="@firebase/storage",h8="0.14.0",h4="storage";(0,v._registerComponent)(new E.Component(h4,function(e,{instanceIdentifier:t}){return new h6(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,v.SDK_VERSION)},"PUBLIC").setMultipleInstances(!0)),(0,v.registerVersion)(h3,h8,""),(0,v.registerVersion)(h3,h8,"esm2020");let h9=(0,b.initializeApp)({apiKey:"AIzaSyAa6Irm56xKIcGLTMO3jCWfebG-JxGVr9s",authDomain:"decent-academy.firebaseapp.com",projectId:"decent-academy",storageBucket:"decent-academy.firebasestorage.app",messagingSenderId:"198008941646",appId:"1:198008941646:web:05b646e45147c640e4671f",measurementId:"G-0G8L8ZFTBE"}),h7=(0,I.getAuth)(h9),ce=lQ(h9),ct=function(e=(0,v.getApp)(),t){e=(0,hK.getModularInstance)(e);let r=(0,v._getProvider)(e,h4).getImmediate({identifier:void 0}),n=(0,hK.getDefaultEmulatorHostnameAndPort)("storage");return n&&function(e,t,r,n={}){!function(e,t,r,n={}){e.host=`${t}:${r}`;let i=(0,hK.isCloudWorkstation)(t);i&&((0,hK.pingServer)(`https://${e.host}/b`),(0,hK.updateEmulatorBanner)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:(0,hK.createMockUserToken)(s,e.app.options.projectId))}(e,t,r,n)}(r,...n),r}(h9);e.s(["auth",0,h7,"db",0,ce,"default",0,h9,"storage",0,ct],76009)}]);